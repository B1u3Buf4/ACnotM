<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>07-16</div>
<div class="tit"><h1 class="entry-title">HDU 4471-Homework-快速幂-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/basis/sort" rel="category tag" title="查看排序中的全部文章">排序</a>, <a href="http://www.acmerblog.com/category/math/number-theory" rel="category tag" title="查看数论应用中的全部文章">数论应用</a></span><span class="i4">围观95次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7484" href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comments" title="《HDU 4471-Homework-快速幂-[解题报告]HOJ》上的评论">6 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Homework</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
GS is suffering from tons of boring math assignment. He find it make him tired and impatient so he asks you to finish his assignment in hope that he could hang out in many places of interest and enjoy his life.<br/>In this assignment, you’re asked to solve the following problem:<br/>Given a recurrent function<br/><center><img alt="Blackjack" src="http://www.acmerblog.com/img/1445710830817.jpg"/></center><br/>and boundary values<br/><center><img alt="Blackjack" src="http://www.acmerblog.com/img/1445710830912.jpg"/></center><br/>You should solve for f[n].<br/>What a easy problems! Wait for a moment, you see a few lines in the last paragraph. It reads as follows: To make the problem a little hard, you are now informed that, at some special values of n (there are q such values, namely n<sub>1</sub>, n<sub>2</sub>, . . . , n<sub>q</sub>), the recurrent formula changes into something else, which means for the k<sup>th</sup> such value n<sub>k</sub>, the recurrent formula changes into<br/><center><img alt="Blackjack" src="http://www.acmerblog.com/img/1445710831000.jpg"/></center><br/>Still an easy problem, isn’t it?<br/>Since f[n] may be quite large, you just need to output f[n] module 10<sup>9</sup> + 7. </div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
There are several test cases.<br/>For each test case, the first line contains three integers n (m &lt; n ≤ 10<sub>9</sub>), m (1 ≤ m ≤ 100), q (0 ≤ q ≤ 100). The second line contains m integers, namely f[1], f[2], . . . , f[m].<br/>The following line contains several integers, first comes t (t ≤ 100), then t integers namely c[1], c[2], . . . , c[t].<br/>The following q lines describe q special cases of the recurrent formula, each containing several integers, namely n<sub>k</sub>, t<sub>k</sub> (t<sub>k</sub> ≤ 100, t<sub>k</sub> &lt; n<sub>k</sub>), c<sub>k</sub>[1], c<sub>k</sub>[2], . . . , c<sub>k</sub>[t<sub>k</sub>], as mentioned earlier. It is satisfied that n<sub>i</sub> != n<sub>j</sub> if i != j.<br/>All integers are non-negative. Unless specified, all integers are not greater than 10<sup>9</sup>.<br/>Input is terminated by EOF.<br/>You might assume that all given data is correct. </div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
There are several test cases.<br/>For each test case, the first line contains three integers n (m &lt; n ≤ 10<sub>9</sub>), m (1 ≤ m ≤ 100), q (0 ≤ q ≤ 100). The second line contains m integers, namely f[1], f[2], . . . , f[m].<br/>The following line contains several integers, first comes t (t ≤ 100), then t integers namely c[1], c[2], . . . , c[t].<br/>The following q lines describe q special cases of the recurrent formula, each containing several integers, namely n<sub>k</sub>, t<sub>k</sub> (t<sub>k</sub> ≤ 100, t<sub>k</sub> &lt; n<sub>k</sub>), c<sub>k</sub>[1], c<sub>k</sub>[2], . . . , c<sub>k</sub>[t<sub>k</sub>], as mentioned earlier. It is satisfied that n<sub>i</sub> != n<sub>j</sub> if i != j.<br/>All integers are non-negative. Unless specified, all integers are not greater than 10<sup>9</sup>.<br/>Input is terminated by EOF.<br/>You might assume that all given data is correct.</div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
7 5 0
1 1 2 3 5
2 1 1
10 5 1
1 1 2 3 5
2 1 1
10 2 1 2</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
Case 1: 13
Case 2: 76
<div style="font-family:Times New Roman;font-size:14px;background-color:F4FBFF;border:#B7CBFF 1px dashed;padding:6px"><div style="font-family:Arial;font-weight:bold;color:#7CA9ED;border-bottom:#B7CBFF 1px dashed"><i>Hint</i></div>
In the first sample, you are to solve for f[7] where f[n] = f[n−1]+f[n−2] and f[1] = 1,
f[2] = 1, f[3] = 2, f[4] = 3, f[5] = 5.
In the second example, you are to solve for f[10] where f[n] = f[n − 1] + f[n − 2] and
f[1] = 1, f[2] = 1, f[3] = 2, f[4] = 3, f[5] = 5, as well as specially f[10] = f[9] + 2*f[8].
</div><i style="font-size:1px"> </i></pre>
<p> <!-- problem end --></p>
<p>题目链接：</p>
<p>http://acm.hdu.edu.cn/showproblem.php?pid=4471</p>
<p>解题思路，矩阵快速幂····特殊点特殊处理·····</p>
<p>令h为计算某个数最多须知前h个数，于是写出方程：</p>
<p>D =</p>
<table border="1">
<tbody>
<tr>
<td>c1</td>
<td>c2</td>
<td>“`</td>
<td>c[h-1]</td>
<td>c[h]</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>“`</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>“`</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td> </td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td> </td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>V[x] =</p>
<table border="1">
<tbody>
<tr>
<td>f[x]</td>
</tr>
<tr>
<td>f[x-1]</td>
</tr>
<tr>
<td>`</td>
</tr>
<tr>
<td>`</td>
</tr>
<tr>
<td>f[x-h+1]</td>
</tr>
</tbody>
</table>
<p>显然有V[x+1] = D*V[x].D是由系数行向量，一个(h-1)*(h-1)的单位矩阵，和一个(h-1)*1的0矩阵组成。V[x]是一个h行，1列的矩阵。</p>
<p>初始条件为V[m] = (f[m],f[m-1],““`).如果m&gt;h,那么多余的部分不会用到，如果m&lt;h剩下的部分用0取代，相当于人为的添加前项f[0] = 0,f[-1] = 0·····这不会影响结果，而且式子仍然成立。由此计算出V[n],答案就为V[1][1].</p>
<p>其余看一下代码就OK了，还有别人的解题报告，也可以看一下：</p>
<p>链接：</p>
<p>http://www.07net01.com/program/547544.html</p>
<p>我的代码：</p>
<pre class="brush:cpp"> #include&lt;cstdio&gt;
 #include&lt;algorithm&gt;
 using namespace std;
 const int N =102;
 const int mod = 1000000007;
 int h;//计算f[x]时最多和前面h个数有关
 struct matrix
 {
     int row,col;
     int m[N][N];
     void init(int row,int col)
     {
         this-&gt;row = row;
         this-&gt;col = col;
         for(int i=0; i&lt;=row; ++i)
             for(int j=0; j&lt;=col; ++j)
                 m[i][j] = 0;
     }
 } A,pm[33],ans;
 
 matrix operator*(const matrix &amp; a,const matrix&amp; b)
 {
     matrix res;
     res.init(a.row,b.col);
     for(int k=1; k&lt;=a.col; ++k)
     {
         for(int i=1; i&lt;= res.row; ++i)
         {
             if(a.m[i][k] == 0 ) continue;
             for(int j = 1; j&lt;=res.col; ++j)
             {
                 if(b.m[k][j] == 0 ) continue;
                 res.m[i][j] = (1LL *a.m[i][k]*b.m[k][j] + res.m[i][j])%mod;
             }
         }
     }
     return res;
 }
 
 void cal(int x)
 {
     for(int i=0; i&lt;=31; ++i)
         if(x &amp; (1&lt;&lt;i) ) ans = pm[i]*ans;
 }
 void getPm()
 {
     pm[0] = A;
     for(int i=1; i&lt;=31; ++i)
         pm[i] = pm[i-1]*pm[i-1];
 }
 struct sp//特殊点
 {
     int nk,tk;//nk为点的位置，tk为计算nk时和前面tk个数有关
     int ck[N];
     bool operator&lt;(const sp &amp; o)const//按照nk排序
     {
         return nk&lt;o.nk;
     }
 } p[N];
 int main()
 {
 //    freopen("in.txt","r",stdin);
     int n,m,q,t,f[N],c[N],kase=0;
     while(~scanf("%d%d%d",&amp;n,&amp;m,&amp;q))
     {
         for(int i=m; i&gt;0; --i)   scanf("%d",&amp;f[i]);
         scanf("%d",&amp;t);
         h =t;
         for(int i=1; i&lt;=t; ++i)  scanf("%d",&amp;c[i]);
         for(int i=0; i&lt;q; ++i)
         {
             scanf("%d%d",&amp;p[i].nk,&amp;p[i].tk);
             if(p[i].tk &gt; h) h = p[i].tk;
             for(int j=1; j&lt;=p[i].tk; ++j) scanf("%d",&amp;p[i].ck[j]);
         }
         sort(p,p+q);
         A.init(h,h);
         for(int i=1; i&lt;=t; ++i) A.m[1][i] = c[i];
         for(int i=2; i&lt;=h; ++i)  A.m[i][i-1] = 1;
         getPm();
         ans.init(h,1);
         for(int i = m; i &gt; 0; --i)   ans.m[i][1] = f[i];
         int last=m;
         for(int i=0; i&lt;q; ++i)
         {
             if( p[i].nk &lt;=last ||  p[i].nk &gt;n ) continue;
             cal( p[i].nk-last-1);
             last =  p[i].nk;
             for(int j=1; j&lt;=p[i].tk; ++j)  A.m[1][j] = p[i].ck[j];
             for(int j=p[i].tk+1; j&lt;=h; ++j) A.m[1][j] = 0;
             ans  =A*ans;
         }
         cal(n-last);
         printf("Case %d: %d\n",++kase,ans.m[1][1]);
     }
     return 0;
 }
</pre>
<p> </p>
<p>参考：http://www.cnblogs.com/allh123/p/3296276.html</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-97902">
<article class="comment" id="comment-97902">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919513285" rel="external nofollow">新用户573097</a></span> on <a href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comment-97902" rel="nofollow"><time datetime="2017-04-20T08:48:53+00:00" pubdate="">2017年4月20日 at 上午8:48</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>真幸福 真好</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-67773">
<article class="comment" id="comment-67773">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919521497" rel="external nofollow">新用户328079</a></span> on <a href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comment-67773" rel="nofollow"><time datetime="2017-04-11T00:40:28+00:00" pubdate="">2017年4月11日 at 上午12:40</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>玫瑰公主尼玛，全家死光光</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-67772">
<article class="comment" id="comment-67772">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919521497" rel="external nofollow">新用户328079</a></span> on <a href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comment-67772" rel="nofollow"><time datetime="2017-04-11T00:40:28+00:00" pubdate="">2017年4月11日 at 上午12:40</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>玫瑰公主尼玛，全家死光光</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-67771">
<article class="comment" id="comment-67771">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919521497" rel="external nofollow">新用户328079</a></span> on <a href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comment-67771" rel="nofollow"><time datetime="2017-04-11T00:40:28+00:00" pubdate="">2017年4月11日 at 上午12:40</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>玫瑰公主尼玛，全家死光光</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-67770">
<article class="comment" id="comment-67770">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919521497" rel="external nofollow">新用户328079</a></span> on <a href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comment-67770" rel="nofollow"><time datetime="2017-04-11T00:40:28+00:00" pubdate="">2017年4月11日 at 上午12:40</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>玫瑰公主尼玛，全家死光光</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-67769">
<article class="comment" id="comment-67769">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919521497" rel="external nofollow">新用户328079</a></span> on <a href="http://www.acmerblog.com/hdu-4471-homework-7484.html#comment-67769" rel="nofollow"><time datetime="2017-04-11T00:40:28+00:00" pubdate="">2017年4月11日 at 上午12:40</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>玫瑰公主尼玛，全家死光光</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>