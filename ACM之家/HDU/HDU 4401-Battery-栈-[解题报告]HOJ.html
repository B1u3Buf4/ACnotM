<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>05-24</div>
<div class="tit"><h1 class="entry-title">HDU 4401-Battery-栈-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/data-struct/linear" rel="category tag" title="查看线性结构中的全部文章">线性结构</a></span><span class="i4">围观171次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7412" href="http://www.acmerblog.com/hdu-4401-battery-7412.html#comments" title="《HDU 4401-Battery-栈-[解题报告]HOJ》上的评论">3 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Battery</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
Recently hzz invented a new kind of solar battery. The battery is so amazing that the electric power generated by it can satisfy the entire village. People in the villager are all very happy since they can get free and green energy from now on. But the manager of a power company is sorrow about this. So he plans to take some action to obstruct the battery.
<p>The battery can be regarded as a segment of L meters. And the manager plans to build n pillars on the battery.<br/></p><center><img alt="Mines" src="http://www.acmerblog.com/img/1441116767635.jpg"/></center> <br/>Like the picture above, the distance between pillar i and the battery’s left end is Xi, and its height is Hi. The thickness of all pillars can be ignored. When the sunlight is slant, some part of the battery will be sheltered by the pillars.
<p>One meter battery exposed in the vertical sunlight for one hour will generate one unit of energy. If the sunlight is slant, the amount of energy generated should be multiplied by sinβ (β is the angle between sunlight and horizontal line).</p>
<p>The sun rises from the infinite far left end of the horizon at 6 o’clock and goes down at the infinite far right end of the horizon at 18 o’clock. The sun is always infinite far away. So the sunlight is parallel, and β is π/2 at 12 o′clock.</p>
<p>Please calculate the amount of energy generated by the battery between t1 o’clock and t2 o’clock (6 ≤t1&lt;t2≤18 ). </p></div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
There are multiple test cases.<br/>For each test case： <br/>The first line contains two integer L(10≤L≤100,000) andN(4≤N≤1000), indicating the length of the battery and the number of pillars.<br/>The second line contains two integers, above mentioned t1 and t2(6 ≤t1&lt;t2≤18 ).<br/>Then N lines follow, each containing two integers Xi(0≤Xi≤L) and Hi(1≤Hi≤1000), indicating the position and height of a pillar.
<p>It is guaranteed that no two pillars will be in the same position. It is also guaranteed that there is a pillar on both end of the battery. <br/>The input end with L=0, N=0. </p></div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
There are multiple test cases.<br/>For each test case： <br/>The first line contains two integer L(10≤L≤100,000) andN(4≤N≤1000), indicating the length of the battery and the number of pillars.<br/>The second line contains two integers, above mentioned t1 and t2(6 ≤t1&lt;t2≤18 ).<br/>Then N lines follow, each containing two integers Xi(0≤Xi≤L) and Hi(1≤Hi≤1000), indicating the position and height of a pillar.
<p>It is guaranteed that no two pillars will be in the same position. It is also guaranteed that there is a pillar on both end of the battery. <br/>The input end with L=0, N=0.</p></div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
10 4
14 17
0 2
5 1
8 3
10 1
0 0</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
7.97188</pre>
<p> <!-- problem end --></p>
<p><span style="font-size: 18px; font-family: 黑体;">题目链接：<a>http://acm.hdu.edu.cn/showproblem.php?pid=4401</a></span></p>
<p><span style="font-size: 18px; font-family: 黑体;">题意：给出一个长度为L的太阳能电池板。若阳光直射在板上，单位长度单位时间发电为1.斜射的话要乘以sin(x),x为阳光和地面夹角。求某一时间段太阳能电池板的发电量。</span></p>
<p><span style="font-size: 18px; font-family: 黑体;">思路：</span></p>
<p><span style="font-size: 18px; font-family: 黑体;">（1）</span></p>
<p><span style="font-size: 18px; font-family: 黑体;"><img alt="Battery" src="http://cdn.acmerblog.com/img/1441116845371.png"/></span></p>
<p><span style="font-size: 18px; font-family: 黑体;">总的意思就是当前区间可能被之前的柱子挡住，我们将之前的柱子用一个单调栈保存，栈中从栈底到栈顶的柱子逐渐降低且连续两根的斜率的绝对值逐渐增大。求某一区间被哪些柱子挡住时只需要从栈顶向栈底扫描，这样就会将该区间依次划分为几段，依次计算即可；</span></p>
<p><span style="font-size: 18px; font-family: 黑体;">（2）我是首先按照时间划分，而且将时间从[6,18]映射到[0,12]，答案就是ans=deal(T2-6)-deal(T1-6)。设时间为t，若t小于等于6，则直接计算；若大于6，也就是下午还有一段，由于上午下午的对称性，与上午计算类似，设solve(t)表示计算在t&lt;=6时，则若计算t&gt;6时，就是solve(6)+[solve(6)-solve(12-t)],其中方括号里的为下午一段时间的；并且计算下午时要将数组的前后交换，你懂的。。。</span></p>
<p><span style="font-size: 18px; font-family: 黑体;">（3）然后就是对于每一段的发电量就是一个积分：</span></p>
<p><img alt="Battery" height="262" src="http://cdn.acmerblog.com/img/1441116845617.jpg" width="469"/></p>
<p><span style="font-size: 18px; font-family: 黑体;">我们要对黑线中的那段红线积分，积分时间是[0,t]。太阳12小时走了π,那么时刻t与这一时刻与阳光与地面的夹角θ的关系为：t=12/<span>π*<span>θ,所以dt=<span>12/</span><span>πd<span>θ。下面的计算中t1对应<span>θ1时刻，t2对应<span>θ2时刻。</span></span></span></span></span></span></span></p>
<p> </p>
<p><img alt="Battery" src="http://cdn.acmerblog.com/img/1441116845822.jpg"/></p>
<p> </p>
<p><span style="font-size: 18px; font-family: 黑体;">当然，之前要保证t时刻时整个区间都可以被阳光照到。</span></p>
<p> </p>
<div>
<pre><span style="font-size: 18px; font-family: 黑体;"> #include &lt;iostream&gt;
 #include &lt;cstdio&gt;
 #include &lt;cstring&gt;
 #include &lt;cmath&gt;
 #include &lt;algorithm&gt;
 #define PI acos(-1.0)
 using namespace std;
 
 
 struct Node
 {
     double h,x;
 };
 
 Node a[1005],b[1005],st[1005];
 double L;
 int n,T1,T2,top;
 
 inline int DB(double x)
 {
     if(x&gt;1e-10) return 1;
     if(x&lt;-1e-10) return -1;
     return 0;
 }
 
 
 
 double cal1(Node a,Node b)
 {
     double k=(a.h-b.h)/(a.x-b.x);
     double x=a.x-a.h/k;
     return x;
 }
 
 
 double cal2(double x1,double x2,double h,int t)
 {
     double a=sqrt(h*h+x2*x2)-sqrt(h*h+x1*x1);
     double b=(x2-x1)*cos(PI/12.0*t);
     double c=12.0/PI;
     return c*(a-b);
 }
 
 double cal(double x1,double x2,double h,int t)
 {
     double B1,B2,B3;
     if(DB(x1)==0) B1=PI/2;
     else B1=atan(fabs(h/x1));
     B2=atan(fabs(h/x2));
     B3=PI/12*t;
     if(DB(B3-B1)&gt;=0) return cal2(x1,x2,h,t);
     if(DB(B2-B3)&gt;=0) return 0;
     double k=-tan(B3);
     return cal2(-h/k,x2,h,t);
 }
 
 int OK(Node a,Node b,Node c)
 {
     double k1=(a.h-b.h)/(a.x-b.x);
     double k2=(b.h-c.h)/(b.x-c.x);
     if(DB(k1-k2)==-1) return 1;
     return 0;
 }
 
 double solve(int t,Node a[])
 {
     top=0;
     st[++top]=a[1];
     double ans=0;
     int i,j;
     double x1,x2;
     for(i=2;i&lt;=n;i++)
     {
         x1=a[i-1].x;
         x2=a[i-1].x;
         for(j=top;j&gt;=2;j--)
         {
             x2=cal1(st[j-1],st[j]);
             if(DB(x2-a[i].x)&gt;=0) break;
             ans+=cal(x1-st[j].x,x2-st[j].x,st[j].h,t);
             x1=x2;
         }
         ans+=cal(x1-st[j].x,a[i].x-st[j].x,st[j].h,t);
         while(top&gt;=2&amp;&amp;OK(st[top-1],st[top],a[i])||top&gt;=1&amp;&amp;DB(a[i].h-st[top].h)&gt;=0)
              top--;
         st[++top]=a[i];
     }
     return ans;
 }
 
 int cmp(Node a,Node b)
 {
     return a.x&lt;b.x;
 }
 
 double deal(int t)
 {
     double ans=0;
     int i;
     for(i=1;i&lt;=n;i++)
     {
         b[i]=a[n+1-i];
         b[i].x=L-b[i].x;
     }
     double xx,yy,zz;
     if(t&lt;=6) ans=solve(t,a);
     else
     {
         ans=solve(6,a);
         ans+=solve(6,b)-solve(12-t,b);
     }
     return ans;
 }
 
 int main()
 {
     while(scanf("%lf%d",&amp;L,&amp;n),n||L)
     {
         scanf("%d%d",&amp;T1,&amp;T2);
         int i;
         for(i=1;i&lt;=n;i++) scanf("%lf%lf",&amp;a[i].x,&amp;a[i].h);
         sort(a+1,a+n+1,cmp);
         printf("%.5lf\n",deal(T2-6)-deal(T1-6));
     }
     return 0;
 }
</span></pre>
</div>
<p> </p>
<p><span style="font-size: 18px; font-family: 黑体;">　　</span></p>
<p> </p>
<p>参考：http://www.cnblogs.com/jianglangcaijin/archive/2012/10/07/2714054.html</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-98156">
<article class="comment" id="comment-98156">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919514456" rel="external nofollow">新用户598192</a></span> on <a href="http://www.acmerblog.com/hdu-4401-battery-7412.html#comment-98156" rel="nofollow"><time datetime="2017-04-20T11:47:09+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>想都不用想，他们总有道理</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68082">
<article class="comment" id="comment-68082">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919513713" rel="external nofollow">新用户927467</a></span> on <a href="http://www.acmerblog.com/hdu-4401-battery-7412.html#comment-68082" rel="nofollow"><time datetime="2017-04-11T03:57:03+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>hehe姐求连载番外5555555555555555555555555</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-68081">
<article class="comment" id="comment-68081">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919513713" rel="external nofollow">新用户927467</a></span> on <a href="http://www.acmerblog.com/hdu-4401-battery-7412.html#comment-68081" rel="nofollow"><time datetime="2017-04-11T03:57:03+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>hehe姐求连载番外5555555555555555555555555</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>