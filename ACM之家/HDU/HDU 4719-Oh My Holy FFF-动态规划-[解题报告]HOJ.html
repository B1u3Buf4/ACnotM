<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>09-17</div>
<div class="tit"><h1 class="entry-title">HDU 4719-Oh My Holy FFF-动态规划-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/data-struct/trees" rel="category tag" title="查看树形结构中的全部文章">树形结构</a>, <a href="http://www.acmerblog.com/category/dp2/line-dp" rel="category tag" title="查看线性DP中的全部文章">线性DP</a></span><span class="i4">围观60次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7764" href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comments" title="《HDU 4719-Oh My Holy FFF-动态规划-[解题报告]HOJ》上的评论">12 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<h1 style="color:rgb(26,92,200); text-align:center; font-family:'Times New Roman'">
Oh My Holy FFF</h1>
<p><span style="font-family:'Times New Roman'; font-size:14px"><strong><span style="font-family:Arial; font-size:12px; color:green">Time Limit: 5000/2500 MS (Java/Others)    Memory Limit: 65535/65535 K (Java/Others)<br/>
Total Submission(s): 606    Accepted Submission(s): 141<br/>
</span></strong></span><br style="font-family:'Times New Roman'; font-size:14px"/><br/>
<br style="font-family:'Times New Roman'; font-size:14px"/></p>
<div align="left" class="panel_title" style="height:38px; padding:0px 14px; color:rgb(124,169,237); font-size:18px; font-family:Arial; font-weight:bold">
Problem Description</div>
<div class="panel_content" style="height:auto; margin:0px; padding:0px 20px; font-size:14px; font-family:'Times New Roman'">
N soldiers from the famous "*FFF* army" is standing in a line, from left to right.
<pre style="margin-top:0px; margin-bottom:0px"> o   o   o   o   o   o   o   o   o   o   o   o   o   o   o   o   o   o
/F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\ /F\
/ \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \ / \</pre>
<p>
You, as the captain of *FFF*, want to divide them into smaller groups, but each group should still be continous in the original line. Like this:</p>
<pre style="margin-top:0px; margin-bottom:0px"> o   o   o  |  o   o   o   o  |  o   o   o   o   o   o  |  o   o   o   o   o
/F\ /F\ /F\ | /F\ /F\ /F\ /F\ | /F\ /F\ /F\ /F\ /F\ /F\ | /F\ /F\ /F\ /F\ /F\
/ \ / \ / \ | / \ / \ / \ / \ | / \ / \ / \ / \ / \ / \ | / \ / \ / \ / \ / \</pre>
<p>
In your opinion, the number of soldiers in each group should be no more than L.<br/>
Meanwhile, you want your division be "holy". Since the soldier may have different heights, you decide that for each group except the first one, its last soldier(which is the rightmost one) should be strictly taller than the previous group’s last soldier. That<br/>
 is, if we set bi as the height of the last soldier in group i. Then for i &gt;= 2, there should be b<sub>i</sub> &gt; b<sub>i-1</sub>.<br/>
You give your division a score, which is calculated as <img alt="Oh My Holy FFF" src="http://cdn.acmerblog.com/img/1447911740272.jpg" style="border:none"/>, b<sub>0</sub> = 0 and 1 &lt;= k &lt;= M, if there are M groups in total. Note that M can equal to 1.<br/>
Given the heights of all soldiers, please tell us the best score you can get, or declare the division as impossible.</p></div>
<div class="panel_bottom" style="height:auto; margin:0px; font-family:'Times New Roman'; font-size:14px">
 </div>
<p><br style="font-family:'Times New Roman'; font-size:14px"/></p>
<div align="left" class="panel_title" style="height:38px; padding:0px 14px; color:rgb(124,169,237); font-size:18px; font-family:Arial; font-weight:bold">
Input</div>
<div class="panel_content" style="height:auto; margin:0px; padding:0px 20px; font-size:14px; font-family:'Times New Roman'">
The first line has a number T (T &lt;= 10) , indicating the number of test cases.<br/>
For each test case, first line has two numbers N and L (1 &lt;= L &lt;= N &lt;= 10<sup>5</sup>), as described above.<br/>
Then comes a single line with N numbers, from H1 to Hn, they are the height of each soldier in the line, from left to right. (1 &lt;= H<sub>i</sub> &lt;= 10<sup>5</sup>)</div>
<div class="panel_bottom" style="height:auto; margin:0px; font-family:'Times New Roman'; font-size:14px">
 </div>
<p><br style="font-family:'Times New Roman'; font-size:14px"/></p>
<div align="left" class="panel_title" style="height:38px; padding:0px 14px; color:rgb(124,169,237); font-size:18px; font-family:Arial; font-weight:bold">
Output</div>
<div class="panel_content" style="height:auto; margin:0px; padding:0px 20px; font-size:14px; font-family:'Times New Roman'">
For test case X, output "Case #X: " first, then output the best score.</div>
<div class="panel_bottom" style="height:auto; margin:0px; font-family:'Times New Roman'; font-size:14px">
 </div>
<p><br style="font-family:'Times New Roman'; font-size:14px"/></p>
<div align="left" class="panel_title" style="height:38px; padding:0px 14px; color:rgb(124,169,237); font-size:18px; font-family:Arial; font-weight:bold">
Sample Input</div>
<div class="panel_content" style="height:auto; margin:0px; padding:0px 20px; font-size:14px; font-family:'Times New Roman'">
<pre style="margin-top:0px; margin-bottom:0px"><div style="font-family:'Courier New',Courier,monospace">2
5 2
1 4 3 2 5
5 2
5 4 3 2 1</div></pre>
</div>
<div class="panel_bottom" style="height:auto; margin:0px; font-family:'Times New Roman'; font-size:14px">
 </div>
<p><br style="font-family:'Times New Roman'; font-size:14px"/></p>
<div align="left" class="panel_title" style="height:38px; padding:0px 14px; color:rgb(124,169,237); font-size:18px; font-family:Arial; font-weight:bold">
Sample Output</div>
<div class="panel_content" style="height:auto; margin:0px; padding:0px 20px; font-size:14px; font-family:'Times New Roman'">
<pre style="margin-top:0px; margin-bottom:0px"><div style="font-family:'Courier New',Courier,monospace">Case #1: 31
Case #2: No solution</div></pre>
</div>
<div class="panel_bottom" style="height:auto; margin:0px; font-family:'Times New Roman'; font-size:14px">
 </div>
<div><span style="font-size:32px; color:#ff0000">题意：</span><strong><span style="font-size:24px">n(n &lt; 1e5)个人排成一行，把它切成若干堆，要求每一堆的长度不超过l(l &lt; 1e5),并且每一堆的最右一个人的身高都要比前一堆的最右一个人的身高要高，对于每一种方案，它的分数是SUM(b[k]^2-b[k-1] )  b[k] 为第k堆最右一个人的身高 要求最高的分数。</span></strong></div>
<div><span style="font-size:32px; color:#ff0000">思路：</span><span style="font-size:24px"><strong>朴素的DP 是  DP[i]  = max(DP[j] – b[j]) + b[i]*b[i]  ( i-l &lt;=  j &lt;= i-1 )  但是这样会超时（O(n^2)） 可以发现每次求DP[i] 的时候 实际就是求 区间[i-l,i-1]  DP[j]-b[j]的最大值，因此可以利用线段树优化，此时还需要解决一个问题：就是如何保证每次求DP[i]的时候保证区间[i-l,i-1]<br/>
 的每个人的身高都是比自己矮的？  可以进行先排序，让矮的人先选，如果身高一样就让序号在后的先选，这样就不会有冲突了（单点更新的时候）。 每次查询的时候单点更新即可。</strong></span></div>
<div><span style="font-size:24px"><strong></strong></span>
<pre class="brush:cpp" name="code">#include &lt;iostream&gt;
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;
using namespace std;
#define REP(_,a,b)  for(int _=(a); _&lt;=(b);++_)
#define sz(s) (int)((s).size())
typedef long long ll;
const int maxn = 1e5+10;
int n,l;
ll dp[maxn];
struct Num{
	ll h;
	int idx;
	Num(ll h = 0,int idx = 0):h(h),idx(idx){}
	friend bool operator &lt; (Num a,Num b){
		if(a.h!=b.h) return a.h &lt; b.h;
		else return a.idx &gt; b.idx;
	}
};
vector&lt;Num&gt; vN;
struct node{
	int lson,rson;
	ll maxx;
	int mid(){
		return (lson+rson)&gt;&gt;1;
	}
}tree[maxn*4];
void pushUp(int rt){
	tree[rt].maxx = max(tree[rt&lt;&lt;1].maxx,tree[rt&lt;&lt;1|1].maxx);
} 

void build(int L,int R,int rt){
	tree[rt].lson = L;
	tree[rt].rson = R;
	tree[rt].maxx = -1;
	if(L==R){	
		return;
	}
	int mid = tree[rt].mid();
	build(L,mid,rt&lt;&lt;1);
	build(mid+1,R,rt&lt;&lt;1|1);
}
void init(){
	vN.clear();
	memset(dp,-1,sizeof dp);
}
void update(int pos,int l,int r,int rt,ll x){
	if(l==r){
		tree[rt].maxx = x;
		return;
	}
	int mid = tree[rt].mid();
	if(pos&lt;=mid){
		update(pos,l,mid,rt&lt;&lt;1,x);
	}else{
		update(pos,mid+1,r,rt&lt;&lt;1|1,x);
	}
	pushUp(rt);
}
ll query(int L,int R,int l,int r,int rt){
	if(L &lt;=l &amp;&amp; R &gt;= r){
		return tree[rt].maxx;
	}
	int mid = tree[rt].mid();
	ll ret;
	bool flag = false;
	if(L &lt;= mid){
		ret = query(L,R,l,mid,rt&lt;&lt;1);
		flag = true;
	}
	if(R &gt; mid){
		if(flag){
			ret = max(ret,query(L,R,mid+1,r,rt&lt;&lt;1|1));
		}else{
			ret = query(L,R,mid+1,r,rt&lt;&lt;1|1);
		}
	}
	return ret;
}
void input(){
	scanf("%d%d",&amp;n,&amp;l);
	REP(_,1,n){
		ll h;
		scanf("%I64d",&amp;h);
		vN.push_back(Num(h,_));
	}
	sort(vN.begin(),vN.end());
	build(0,n,1);
}
void solve(){
	update(0,0,n,1,0);
	REP(_,0,sz(vN)-1) {	
		int ni = vN[_].idx;
		ll nh = vN[_].h;
		ll tm = query(max(ni-l,0),ni-1,0,n,1);
		if(tm&gt;=0){
			dp[ni] = tm+nh*nh;
			update(ni,0,n,1,dp[ni]-nh);
		}
		if(ni==n) break;
	}
	if(dp[n]&lt;=0){
		printf("No solution\n");	
	}else{
		printf("%I64d\n",dp[n]);
	}
}
int main(){
	int ncase,T=1;
	cin &gt;&gt; ncase;
	while(ncase--){
		init();	
		input();
		printf("Case #%d: ",T++);
		solve();	
	}
	return 0;
} </pre>
</div>
<div style="padding-top:20px">
<p style="font-size:12px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<p>参考：http://blog.csdn.net/mowayao/article/details/38687671</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-97092">
<article class="comment" id="comment-97092">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97092" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-97091">
<article class="comment" id="comment-97091">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97091" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-97090">
<article class="comment" id="comment-97090">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97090" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-97089">
<article class="comment" id="comment-97089">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97089" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-97088">
<article class="comment" id="comment-97088">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97088" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-97087">
<article class="comment" id="comment-97087">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97087" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-97086">
<article class="comment" id="comment-97086">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97086" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-97085">
<article class="comment" id="comment-97085">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97085" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-97084">
<article class="comment" id="comment-97084">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97084" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-97083">
<article class="comment" id="comment-97083">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97083" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-97082">
<article class="comment" id="comment-97082">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97082" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-97081">
<article class="comment" id="comment-97081">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919459258" rel="external nofollow">新用户012951</a></span> on <a href="http://www.acmerblog.com/hdu-4719-oh-my-holy-fff-7764.html#comment-97081" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"></div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>