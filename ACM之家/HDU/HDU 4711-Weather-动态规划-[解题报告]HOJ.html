<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>09-17</div>
<div class="tit"><h1 class="entry-title">HDU 4711-Weather-动态规划-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/basis/enumeration" rel="category tag" title="查看枚举中的全部文章">枚举</a>, <a href="http://www.acmerblog.com/category/dp2/line-dp" rel="category tag" title="查看线性DP中的全部文章">线性DP</a></span><span class="i4">围观85次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7756" href="http://www.acmerblog.com/hdu-4711-weather-7756.html#comments" title="《HDU 4711-Weather-动态规划-[解题报告]HOJ》上的评论">一条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Weather</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
Hovey Chen is going to Azeroth! "I have reached Darnassus." Hovey told Eliane Su, his girlfriend. Each day, Hovey called Eliane, and told her his feeling at Azeroth. "It’s a good day today. We are going to hunt some Goblin :)" "It’s raining and raining. We can do nothing but sleeping :(" <br/>Several days later, Hovey was missing Eliane so much. So he came back to the Earth. He wants to write a travel note for his friends. However, he forgets where he had been! What’s worse, he never told Eliane he route. Luckily, he told Eliane the weather in his everyday report, and Eliane wrote it down on her notebook. Hovey knows the probability he went from one place to another. Given the probability from Darnassus to Booty Bay be p, it means that if Hovey is at Darnassus today, the chance he is going to Booty Bay tomorrow is p. Eliane knows the probability of given place to be in given weather. Now given the first place, and the two probability matrices, can you help Hovey to figure out the route which has the greatest probablity. </div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
The first line is an integer T， the number of test cases.<br/>In each test cases, the first is three positive integers n, m, w (1 ≤ n ≤ 1000, 1 ≤ m, w ≤ 100). Hovey has stayed in Azeroth for n + 1 days. Days are labeled from 0 to n. The number of places in Azeroth is m. The number of weather conditions in Azeroth is w. Hovey was always at Darnassus in day 0, which is place 0.<br/>Then n integers follow, each is in the range of [0, w - 1]. They are weather conditions from day 1 to n.<br/>Then m lines follow, each containing m numbers. The jth number in the ith line is the probabilty from place i to place j. Places are numbered from 0.<br/>Then m lines follow, each containing w numbers. The jth number in the ith line is the probabilty that place i is in weather condition j. Weather conditions are numbered from 0. </div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
The first line is an integer T， the number of test cases.<br/>In each test cases, the first is three positive integers n, m, w (1 ≤ n ≤ 1000, 1 ≤ m, w ≤ 100). Hovey has stayed in Azeroth for n + 1 days. Days are labeled from 0 to n. The number of places in Azeroth is m. The number of weather conditions in Azeroth is w. Hovey was always at Darnassus in day 0, which is place 0.<br/>Then n integers follow, each is in the range of [0, w - 1]. They are weather conditions from day 1 to n.<br/>Then m lines follow, each containing m numbers. The jth number in the ith line is the probabilty from place i to place j. Places are numbered from 0.<br/>Then m lines follow, each containing w numbers. The jth number in the ith line is the probabilty that place i is in weather condition j. Weather conditions are numbered from 0.</div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
1
3 3 2
1 1 0
0.3 0.5 0.2
0.1 0.2 0.7
0.3 0.3 0.4
0.6 0.4
0.4 0.6
0.3 0.7</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
1 2 0</pre>
<p> <!-- problem end --></p>
<p><a target="_blank">题目</a></p>
<p><a target="_blank">比赛</a>
</p>
<p>题意：</p>
<p>有m座城市w种天气，已知每天从城市i到城市j的概率，和每座城市每种天气的概率。已知n天的行程每天的天气，求最有可能的这n天每天在哪座城市的序列。多组解输出字典序最小的。</p>
<p>题解：</p>
<p>直接DP，一天天枚举从i到j地转移。由于n最大1000,直接乘精度受不了，最好取log，并且注意概率为0时返回结果为nan，所以自己手动设一个-INF吧。</p>
<p>比赛时3个人读题都看到了旅行了n+1天，并且第一天所在位置是固定的，但是找了很久都没找到在哪说了。可能是因为当时HDU已经跪了吧，第一次交是在还有一个半小时的时候，等到4点才返回个RE，但是那是所有的status都是0ms0KB的RE。后来剩40分钟的时候又交，一直没结果。所以大家都懒得再想了，想出了也不能交……很神奇的是吃完饭回来一眼就看到题目说了第一天是在第0座城市，加上这句再交果然过了。</p>
<p>
</p>
<pre class="brush:cpp" name="code">//Time:343ms
//Memory：2208KB
//Length:1875B
#include &lt;iostream&gt;
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;cstring&gt;
#include &lt;cmath&gt;
#include &lt;map&gt;
using namespace std;
#define MP(x,y) make_pair(x,y)
const int MAXN= 110;
const double EPS = 1e-14;
const double INF = 1e50;

long double dp[1010][MAXN];
int fa[1010][MAXN],ord[1010];
double pm[MAXN][MAXN],pw[MAXN][MAXN];
int main()
{
    //freopen("/home/moor/Code/input","r",stdin);
    int ncase,n,m,w;
    scanf("%d",&amp;ncase);
    while(ncase--)
    {
        scanf("%d%d%d",&amp;n,&amp;m,&amp;w);
        for(int i=0;i&lt;n;++i)    scanf("%d",&amp;ord[i]);
        for(int i=0;i&lt;m;++i)
            for(int j=0;j&lt;m;++j)
            {
                scanf("%lf",&amp;pm[i][j]);
                if(pm[i][j]&gt;EPS)
                    pm[i][j]=log(pm[i][j]);
                else    pm[i][j]=-INF;
            }
        for(int i=0;i&lt;m;++i)
            for(int j=0;j&lt;w;++j)
            {
                scanf("%lf",&amp;pw[i][j]);
                if(pw[i][j]&gt;EPS)
                    pw[i][j]=log(pw[i][j]);
                else    pw[i][j]=-INF;
            }
        for(int i=0;i&lt;m;++i)    dp[n-1][i]=pw[i][ord[n-1]];
        for(int i=n-2;i&gt;=0;--i)
        {
            for(int j=0;j&lt;m;++j)    dp[i][j]=-INF;
            for(int j=0;j&lt;m;++j)
                if(pw[j][ord[i]]&gt;-INF+EPS)
                    for(int k=0;k&lt;m;++k)
                        if(pm[j][k]&gt;-INF+EPS&amp;&amp;dp[i][j]+EPS&lt;dp[i+1][k]+pm[j][k]+pw[j][ord[i]])
                            dp[i][j]=dp[i+1][k]+pm[j][k]+pw[j][ord[i]],fa[i][j]=k;
        }
        int pos=0;
        long double best=-INF;
        for(int i=0;i&lt;m;++i)
            if(best+EPS&lt;dp[0][i]+pm[0][i])
                best=dp[0][i]+pm[0][i],pos=i;
        printf("%d",pos);
        for(int i=0;i&lt;n-1;++i)
            printf(" %d",pos=fa[i][pos]);
        printf("\n");
    }
    return 0;
}

</pre>
<div style="padding-top:20px">
<p style="font-size:12px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<p>参考：http://blog.csdn.net/tri_integral/article/details/11395583</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-97137">
<article class="comment" id="comment-97137">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919529195" rel="external nofollow">新用户278894</a></span> on <a href="http://www.acmerblog.com/hdu-4711-weather-7756.html#comment-97137" rel="nofollow"><time datetime="2017-04-20T00:52:30+00:00" pubdate="">2017年4月20日 at 上午12:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>也有初中生搞全球治理。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>