<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>07-25</div>
<div class="tit"><h1 class="entry-title">HDU 4553-约会安排-线段树-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/data-struct" rel="category tag" title="查看数据结构中的全部文章">数据结构</a>, <a href="http://www.acmerblog.com/category/data-struct/trees" rel="category tag" title="查看树形结构中的全部文章">树形结构</a></span><span class="i4">围观105次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7574" href="http://www.acmerblog.com/hdu-4553-7574.html#comments" title="《HDU 4553-约会安排-线段树-[解题报告]HOJ》上的评论">2 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">约会安排</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
　　寒假来了，又到了小明和女神们约会的季节。<br/>　　小明虽为�潘考堵肱�，但非常活跃，女神们常常在小明网上的大段发言后热情回复“呵呵”，所以，小明的最爱就是和女神们约会。与此同时，也有很多基友找他开黑，由于数量实在过于巨大，怎么安排时间便成了小明的一大心事。<br/>　　我们已知小明一共有T的空闲时间，期间会有很多女神或者基友来找小明。<br/>　　作为一个操作系统曾经怒考71分的大神，小明想到了一个算法，即“首次适应算法”，根据操作系统课本的描述，就是找一段最靠前的符合要求的连续空间分配给每个请求，由此小明做出了一个决定：<br/>　　当一个基友来找小明时，小明就根据“首次适应算法”来找一段空闲的时间来和基友约好，如果找到，就说“X,let’s fly”（此处，X为开始时间），否则就说“fly with yourself”；<br/>　　当女神来找小明时，先使用一次“首次适应算法”，如果没有找到，小明就冒着木叽叽的风险无视所有�潘炕�友的约定，再次使用“无视基友首次适应算法”，两次只要有一次找到，就说“X,don’t put my gezi”（此处，X为开始时间），否则就说“wait for me”<br/>　　当然，我们知道小明不是一个节操负无穷的人，如果和女神约会完，还有剩余时间，他还是会和原来约好的基友去dota的。（举个例子：小西（�潘浚┖托∶髟己迷�1~5这个时间单位段内打dota，这时候，女神来和小明预约长度为3的时间段，那么最终就是1~3小明去和女神约会，搞定后在4~5和小西打dota）<br/>　　小明偶尔也会想要学习新知识，此时小明就会把某一个时间区间的所有已经预定的时间全部清空用来学习并且怒吼“I am the hope of chinese chengxuyuan!!”，不过小明一般都是三分钟热度，再有人来预定的话，小明就会按耐不住寂寞把学习新知识的时间分配出去。 </div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
输入第一行为CASE，表示有CASE组测试数据；<br/>每组数据以两个整数T，N开始，T代表总共的时间，N表示预约请求的个数；<br/>接着的N行，每行表示一个女神或者基友的预约，“NS QT”代表一个女神来找小明约一段长为QT的时间，“DS QT”则代表一个�潘康某の�QT的请求，当然也有可能是小明想学知识了，“STUDY!! L R”代表清空L~R区间内的所有请求。
<p>[Technical Specification]<br/>1. 1 &lt;= CASE &lt;= 30<br/>2. 1 &lt;= T,  N &lt;= 100000<br/>3. 1 &lt;= QT &lt;= 110000<br/>4. 1 &lt;= L &lt;= R &lt;=T </p></div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
输入第一行为CASE，表示有CASE组测试数据；<br/>每组数据以两个整数T，N开始，T代表总共的时间，N表示预约请求的个数；<br/>接着的N行，每行表示一个女神或者基友的预约，“NS QT”代表一个女神来找小明约一段长为QT的时间，“DS QT”则代表一个�潘康某の�QT的请求，当然也有可能是小明想学知识了，“STUDY!! L R”代表清空L~R区间内的所有请求。
<p>[Technical Specification]<br/>1. 1 &lt;= CASE &lt;= 30<br/>2. 1 &lt;= T,  N &lt;= 100000<br/>3. 1 &lt;= QT &lt;= 110000<br/>4. 1 &lt;= L &lt;= R &lt;=T</p></div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
1
5 6
DS 3
NS 2
NS 4
STUDY!! 1 5
DS 4
NS 2</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
Case 1:
1,let's fly
4,don't put my gezi
wait for me
I am the hope of chinese chengxuyuan!!
1,let's fly
1,don't put my gezi</pre>
<p> <!-- problem end --><br/>
解题思路：就是线段树的区间合并，在每个区间内设置女神区间和屌丝区间，根据题意，每次询问女神的时候，先看屌丝区间有无空位，有就插到屌丝区间内，同时更新女神区间，否则插到女神区间内，但同时也要更新屌丝区间，因为只有女神可以占用屌丝的时间，屌丝不能占用女神的时间，每次更新屌丝区间的时候直接更新即可，清空的话就是对屌丝和女神的区间都清空。<br/>
PS:这一题比赛的时候没做出来可惜了，不过能做出来而且一次AC，本蒟蒻还是很开心的^-^!</p>
<pre class="brush:cpp">#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;cstring&gt;
#include&lt;algorithm&gt;
#include&lt;cmath&gt;
#include&lt;string&gt;
#include&lt;set&gt;
#include&lt;vector&gt;
#include&lt;map&gt;
#include&lt;list&gt;
#include&lt;queue&gt;
#include&lt;stack&gt;
#define Max 100005
using namespace std;
#define lson l,m,rt&lt;&lt;1
#define rson m+1,r,rt&lt;&lt;1|1
struct
{
	int lds;
	int rds;
	int mds;
	int lns;
	int rns;
	int mns;
	int coverds;
	int coverns;
}tree[Max&lt;&lt;2];
void build(int l,int r,int rt)
{
	tree[rt].lds=tree[rt].rns=tree[rt].rds=tree[rt].lns=tree[rt].mds=tree[rt].mns=r-l+1;
	tree[rt].coverds=tree[rt].coverns=-1;
	if(l==r)
	    return ;
	int m=(l+r)&gt;&gt;1;
	build(lson);
	build(rson);
}
void push_up(int rt,int len,int p)
{
	if(p==0)
	{
	    tree[rt].lds=tree[rt&lt;&lt;1].lds;
	    tree[rt].rds=tree[rt&lt;&lt;1|1].rds;
	    if(tree[rt].lds==len-(len&gt;&gt;1))
		    tree[rt].lds+=tree[rt&lt;&lt;1|1].lds;
	    if(tree[rt].rds==(len&gt;&gt;1))
		    tree[rt].rds+=tree[rt&lt;&lt;1].rds;
	    tree[rt].mds=max(tree[rt&lt;&lt;1].rds+tree[rt&lt;&lt;1|1].lds,max(tree[rt&lt;&lt;1].mds,tree[rt&lt;&lt;1|1].mds));
	}
	else
	{
		tree[rt].lds=tree[rt&lt;&lt;1].lds;
	    tree[rt].rds=tree[rt&lt;&lt;1|1].rds;
	    if(tree[rt].lds==len-(len&gt;&gt;1))
		    tree[rt].lds+=tree[rt&lt;&lt;1|1].lds;
	    if(tree[rt].rds==(len&gt;&gt;1))
		    tree[rt].rds+=tree[rt&lt;&lt;1].rds;
	    tree[rt].mds=max(tree[rt&lt;&lt;1].rds+tree[rt&lt;&lt;1|1].lds,max(tree[rt&lt;&lt;1].mds,tree[rt&lt;&lt;1|1].mds));
		tree[rt].lns=tree[rt&lt;&lt;1].lns;
	    tree[rt].rns=tree[rt&lt;&lt;1|1].rns;
	    if(tree[rt].lns==len-(len&gt;&gt;1))
		    tree[rt].lns+=tree[rt&lt;&lt;1|1].lns;
	    if(tree[rt].rns==(len&gt;&gt;1))
		    tree[rt].rns+=tree[rt&lt;&lt;1].rns;
	    tree[rt].mns=max(tree[rt&lt;&lt;1].rns+tree[rt&lt;&lt;1|1].lns,max(tree[rt&lt;&lt;1].mns,tree[rt&lt;&lt;1|1].mns));
	}
}
void push_down(int rt,int len)
{
	if(tree[rt].coverds!=-1)
	{
		tree[rt&lt;&lt;1].coverds=tree[rt&lt;&lt;1|1].coverds=tree[rt].coverds;
		tree[rt&lt;&lt;1].lds=tree[rt&lt;&lt;1].rds=tree[rt&lt;&lt;1].mds=tree[rt].coverds?0:len-(len&gt;&gt;1);
		tree[rt&lt;&lt;1|1].lds=tree[rt&lt;&lt;1|1].rds=tree[rt&lt;&lt;1|1].mds=tree[rt].coverds?0:(len&gt;&gt;1);
		tree[rt].coverds=-1;
	}
	if(tree[rt].coverns!=-1)
	{
		tree[rt&lt;&lt;1].coverns=tree[rt&lt;&lt;1|1].coverns=tree[rt].coverns;
		tree[rt&lt;&lt;1].lns=tree[rt&lt;&lt;1].rns=tree[rt&lt;&lt;1].mns=tree[rt].coverns?0:len-(len&gt;&gt;1);
		tree[rt&lt;&lt;1|1].lns=tree[rt&lt;&lt;1|1].rns=tree[rt&lt;&lt;1|1].mns=tree[rt].coverns?0:(len&gt;&gt;1);
		tree[rt].coverns=-1;
	}
}
int query(int pos,int p,int l,int r,int rt)
{
	if(l==r)
		return l;
	push_down(rt,r-l+1);
	int m=(l+r)&gt;&gt;1;
	if(p==0)
	{
	    if(pos&lt;=tree[rt&lt;&lt;1].mds)
			return query(pos,p,lson);
		else if(tree[rt&lt;&lt;1].rds+tree[rt&lt;&lt;1|1].lds&gt;=pos)
			return m-tree[rt&lt;&lt;1].rds+1;
		else
			return query(pos,p,rson);
	}
	else
	{
		if(pos&lt;=tree[rt&lt;&lt;1].mns)
			return query(pos,p,lson);
		else if(tree[rt&lt;&lt;1].rns+tree[rt&lt;&lt;1|1].lns&gt;=pos)
			return m-tree[rt&lt;&lt;1].rns+1;
		else
			return query(pos,p,rson);
	}
}
void update(int L,int R,int p,int c,int l,int r,int rt)
{
	if(L&lt;=l&amp;&amp;R&gt;=r)
	{
		if(p==0)
		{
			tree[rt].lds=tree[rt].rds=tree[rt].mds=c?0:r-l+1;
			tree[rt].coverds=c;
		}
		else
		{
			tree[rt].lns=tree[rt].rns=tree[rt].mns=c?0:r-l+1;
			tree[rt].coverns=c;
		}
		return ;
	}
	push_down(rt,r-l+1);
	int m=(l+r)&gt;&gt;1;
	if(L&lt;=m)
		update(L,R,p,c,lson);
	if(R&gt;m)
		update(L,R,p,c,rson);
	push_up(rt,r-l+1,p);
}
int main()
{
	int i,t,m,n,time,a,b,ans;
	char op[10];
	scanf("%d",&amp;t);
	for(i=1;i&lt;=t;i++)
	{
		a=b=0;
		scanf("%d%d",&amp;n,&amp;m);
		build(1,n,1);
		printf("Case %d:\n",i);
		while(m--)
		{
			scanf("%s",op);
			switch(op[0])
			{
			case 'D':
				scanf("%d",&amp;time);
				if(time&gt;tree[1].mds)
					printf("fly with yourself\n");
				else
				{
				    ans=query(time,0,1,n,1);
				    printf("%d,let's fly\n",ans);
					update(ans,ans+time-1,0,1,1,n,1);
				}
				break;
			case 'N':
				scanf("%d",&amp;time);
				if(time&gt;tree[1].mds)
				{
				    if(time&gt;tree[1].mns)
					    printf("wait for me\n");
				    else
				    {
					    ans=query(time,1,1,n,1);
					    printf("%d,don't put my gezi\n",ans);
					    update(ans,ans+time-1,0,1,1,n,1);
					    update(ans,ans+time-1,1,1,1,n,1);
				    }
				}
				else
				{
					ans=query(time,0,1,n,1);
					printf("%d,don't put my gezi\n",ans);
					update(ans,ans+time-1,0,1,1,n,1);
					update(ans,ans+time-1,1,1,1,n,1);
				}
				break;
			case 'S':
				scanf("%d%d",&amp;a,&amp;b);
				printf("I am the hope of chinese chengxuyuan!!\n");
				update(a,b,0,0,1,n,1);
				update(a,b,1,0,1,n,1);
				break;
			}
		}
	}
	return 0;
}</pre>
<p> </p>
<p>参考：http://blog.csdn.net/hqu_fritz/article/details/8945781</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-97576">
<article class="comment" id="comment-97576">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919466017" rel="external nofollow">新用户185092</a></span> on <a href="http://www.acmerblog.com/hdu-4553-7574.html#comment-97576" rel="nofollow"><time datetime="2017-04-20T05:15:18+00:00" pubdate="">2017年4月20日 at 上午5:15</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这特么哪里都开始短袖短裤了，太假了</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-67005">
<article class="comment" id="comment-67005">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919531938" rel="external nofollow">新用户560950</a></span> on <a href="http://www.acmerblog.com/hdu-4553-7574.html#comment-67005" rel="nofollow"><time datetime="2017-04-10T22:27:51+00:00" pubdate="">2017年4月10日 at 下午10:27</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>好开心~</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>