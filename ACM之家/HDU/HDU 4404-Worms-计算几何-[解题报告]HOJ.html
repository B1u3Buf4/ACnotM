<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>05-24</div>
<div class="tit"><h1 class="entry-title">HDU 4404-Worms-计算几何-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/geometry/analytic-geometry" rel="category tag" title="查看解析几何中的全部文章">解析几何</a>, <a href="http://www.acmerblog.com/category/geometry" rel="category tag" title="查看计算几何中的全部文章">计算几何</a></span><span class="i4">围观198次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7415" href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comments" title="《HDU 4404-Worms-计算几何-[解题报告]HOJ》上的评论">12 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Worms</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
<i><b>Worms</b></i> is a series of turn-based computer games. Players control a small platoon of earthworms across a deformable landscape, battling other computer- or player-controlled teams. The game feature bright and humorous cartoon-style animation and a varied arsenal of bizarre weapons.<br/><center><img alt="A very hard Aoshu problem" src="http://www.acmerblog.com/img/1441118874476.jpg"/></center> <br/>During the course of the game, players take turns selecting one of their worms. They then use whatever tools and weapons available to attack and kill the opponents’ worms. Over fifty weapons and tools may be available each time a game is played, and differing selections of weapons and tools can be saved into a “scheme” for easy selection in future games.
<p>When most weapons are used, they cause explosions that deform the terrain, creating circular cavities. If a worm is hit by a weapon, the amount of damage dealt to the worm will be removed from the worm’s initial amount of health. When a worm fall into the water or its health is reduced to zero, it dies.</p>
<p>In this problem, the terrain of a stone can be described as a simple polygon. The worms only use the time bombs. Once a time bomb is thrown, it is only attracted by the force of gravity. In other words, the flying track of the bomb is a parabola. When it reaches the stone (the polygon), the bomb does not blow off or stop immediately. It will still fly along the parabola regardless of the resistance of the stone due to its special character.  The time bomb can only be triggered by the timer. When the preset time is used up, the bomb blows up and eliminates all the materials within its explosion range. You need to calculate the area of the eliminated materials of one explosion. </p></div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
There are multiple test cases.<br/>The first line of a test case contains seven floating numbers x0, y0, v0, θ, t, g, R. (x0, y0) is the position of the worm who throws the bomb, which could be inside the polygon or outside the polygon (even in the sky or under the water). The initial value of velocity is v0 which forms aθ  (0≤θ&lt;90) angle with the positive direction of x-axis. The bomb is always thrown upwards. The preset time is t, which is also the time of flying. The value of acceleration of gravity of the worms’ planet is g. The direction of gravity is the negative direction of y-axis. The explosion range is a circle and R is the radius.
<p>The second line contains an integer n (3≤n≤100), which indicates the number of edges of the stone(simple polygon). The following n lines contain two real numbers xi and yi each, which describe the coordinates of a vertex. Two vertexes in adjacent lines are adjacent on the polygon.</p>
<p>The input contains multiple test cases. It is ended by “0 0 0 0 0 0 0”. </p></div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
There are multiple test cases.<br/>The first line of a test case contains seven floating numbers x0, y0, v0, θ, t, g, R. (x0, y0) is the position of the worm who throws the bomb, which could be inside the polygon or outside the polygon (even in the sky or under the water). The initial value of velocity is v0 which forms aθ  (0≤θ&lt;90) angle with the positive direction of x-axis. The bomb is always thrown upwards. The preset time is t, which is also the time of flying. The value of acceleration of gravity of the worms’ planet is g. The direction of gravity is the negative direction of y-axis. The explosion range is a circle and R is the radius.
<p>The second line contains an integer n (3≤n≤100), which indicates the number of edges of the stone(simple polygon). The following n lines contain two real numbers xi and yi each, which describe the coordinates of a vertex. Two vertexes in adjacent lines are adjacent on the polygon.</p>
<p>The input contains multiple test cases. It is ended by “0 0 0 0 0 0 0”.</p></div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
0 0 15 45 10 2 10
3
100 0
200 0
100 100
0 0 0 0 0 0 0 </pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
228.74</pre>
<p> <!-- problem end --></p>
<p><span style="font-family:Microsoft YaHei; font-size:18px">求出爆炸点的坐标，就成了多边形与圆相交面积的模板题了。。。</span></p>
<p><span style="font-family:Microsoft YaHei; font-size:18px"></span></p>
<pre class="brush:cpp" name="code">#include&lt;algorithm&gt;
#include&lt;iostream&gt;
#include&lt;cstring&gt;
#include&lt;fstream&gt;
#include&lt;sstream&gt;
#include&lt;vector&gt;
#include&lt;string&gt;
#include&lt;cstdio&gt;
#include&lt;bitset&gt;
#include&lt;queue&gt;
#include&lt;stack&gt;
#include&lt;cmath&gt;
#include&lt;map&gt;
#include&lt;set&gt;
#define FF(i, a, b) for(int i=a; i&lt;b; i++)
#define FD(i, a, b) for(int i=a; i&gt;=b; i--)
#define REP(i, n) for(int i=0; i&lt;n; i++)
#define CLR(a, b) memset(a, b, sizeof(a))
#define LL long long
#define PB push_back
#define eps 1e-10
#define debug puts("**debug**")
using namespace std;


const int maxn = 110;
const double PI = acos(-1);
const double TWO_PI = PI * 2;


double NormalizeAngle(double rad, double center = PI)
{
  return rad - TWO_PI * floor((rad + PI - center) / TWO_PI);
}


struct Point
{
    double x, y;
    Point (double x=0, double y=0):x(x), y(y) {}
};
typedef Point Vector;
struct Circle
{
   Point c;
   double r;
   Circle() {}
   Circle(Point c, double r) : c(c), r(r) {}
   Point point(double a) { return Point(c.x+cos(a)*r, c.y+sin(a)*r); }
};
struct Line
{
    Point p;
    Vector v;
    double ang;
    Line(){}
    Line(Point p, Vector v) : p(p), v(v) {ang = atan2(v.y, v.x); }
    Point point(double t)
    {
        return Point(p.x + t*v.x, p.y + t*v.y);
    }
    bool operator &lt; (const Line&amp; L) const
    {
        return ang &lt; L.ang;
    }
};


template &lt;class T&gt; T sqr(T x) { return x * x;}
Vector operator + (Vector A, Vector B) { return Vector(A.x + B.x, A.y + B.y); }
Vector operator - (Vector A, Vector B) { return Vector(A.x - B.x, A.y - B.y); }
Vector operator * (Vector A, double p) { return Vector(A.x*p, A.y*p); }
Vector operator / (Vector A, double p) { return Vector(A.x/p, A.y/p); }
bool operator &lt; (const Point&amp; a, const Point&amp; b) { return a.x &lt; b.x || (a.x == b.x &amp;&amp; a.y &lt; b.y); }
int dcmp(double x)
{
    if(fabs(x) &lt; eps) return 0;
    return x &lt; 0 ? -1 : 1;
}
bool operator == (const Point&amp; a, const Point&amp; b){ return dcmp(a.x-b.x) == 0 &amp;&amp; dcmp(a.y-b.y) == 0;}


double Dot(Vector A, Vector B) { return A.x*B.x + A.y*B.y; }
double Length(Vector A) { return sqrt(Dot(A, A)); }
double Angel(Vector A, Vector B) { return acos(Dot(A, B) / Length(A) / Length(B)); }
double Cross(Vector A, Vector B) { return A.x*B.y - A.y*B.x; }
double torad(double d) { return (d/180)*PI; }
Vector vecunit(Vector x){ return x / Length(x);} //单位向量
Vector normal(Vector x) { return Point(-x.y, x.x) / Length(x);} //垂直法向量
Point GetIntersection(Line a, Line b) //线段交点
{
    Vector u = a.p-b.p;
    double t = Cross(b.v, u) / Cross(a.v, b.v);
    return a.p + a.v*t;
}
bool OnSegment(Point p, Point a1, Point a2)
{
    return dcmp(Cross(a1-p, a2-p)) == 0 &amp;&amp; dcmp(Dot(a1-p, a2-p)) &lt; 0;
}


bool InCircle(Point x, Circle c) { return dcmp(sqr(c.r) - sqr(Length(c.c - x))) &gt;= 0;}
bool OnCircle(Point x, Circle c) { return dcmp(sqr(c.r) - sqr(Length(c.c - x))) == 0;}
double angle(Vector x) { return atan2(x.y, x.x);}


//直线与圆交点
int getLineCircleIntersection(Line L, Circle C, double&amp; t1, double&amp; t2, vector&lt;Point&gt;&amp; sol)
{
    double a=L.v.x, b=L.p.x-C.c.x, c=L.v.y, d=L.p.y-C.c.y;
    double e=a*a+c*c, f=2*(a*b+c*d), g=b*b+d*d-C.r*C.r;
    double delta=f*f-4*e*g;
    if(dcmp(delta) &lt; 0) return 0;
    if(dcmp(delta) == 0)
    {
        t1 = t2 = -f/(2*e); sol.PB(L.point(t1));
        return 1;
    }
    t1 = (-f-sqrt(delta))/(2*e); sol.PB(L.point(t1));
    t2 = (-f+sqrt(delta))/(2*e); sol.PB(L.point(t2));
    return 2;
}


//线段与圆的焦点
int getSegCircleIntersection(Line L, Circle C, Point* sol)
{
    Vector nor = normal(L.v);
    Line pl = Line(C.c, nor);
    Point ip = GetIntersection(pl, L);
    double dis = Length(ip - C.c);
    if (dcmp(dis - C.r) &gt; 0) return 0;
    Point dxy = vecunit(L.v) * sqrt(sqr(C.r) - sqr(dis));
    int ret = 0;
    sol[ret] = ip + dxy;
    if (OnSegment(sol[ret], L.p, L.point(1))) ret++;
    sol[ret] = ip - dxy;
    if (OnSegment(sol[ret], L.p, L.point(1))) ret++;
    return ret;
}


double SegCircleArea(Circle C, Point a, Point b) //线段切割圆
{
    double a1 = angle(a - C.c);
    double a2 = angle(b - C.c);
    double da = fabs(a1 - a2);
    if (da &gt; PI) da = PI * 2.0 - da;
    return dcmp(Cross(b - C.c, a - C.c)) * da * sqr(C.r) / 2.0;
}


double PolyCiclrArea(Circle C, Point *p, int n)//多边形与圆相交面积
{
    double ret = 0.0;
    Point sol[2];
    p[n] = p[0];
    REP(i, n)
    {
        double t1, t2;
        int cnt = getSegCircleIntersection(Line(p[i], p[i+1]-p[i]), C, sol);
        if (cnt == 0)
        {
            if (!InCircle(p[i], C) || !InCircle(p[i+1], C)) ret += SegCircleArea(C, p[i], p[i+1]);
            else ret += Cross(p[i+1] - C.c, p[i] - C.c) / 2.0;
        }
        if (cnt == 1)
        {
            if (InCircle(p[i], C) &amp;&amp; !InCircle(p[i+1], C)) ret += Cross(sol[0] - C.c, p[i] - C.c) / 2.0, ret += SegCircleArea(C, sol[0], p[i+1]);
            else ret += SegCircleArea(C, p[i], sol[0]), ret += Cross(p[i+1] - C.c, sol[0] - C.c) / 2.0;
        }
        if (cnt == 2)
        {
            if ((p[i] &lt; p[i + 1]) ^ (sol[0] &lt; sol[1])) swap(sol[0], sol[1]);
            ret += SegCircleArea(C, p[i], sol[0]);
            ret += Cross(sol[1] - C.c, sol[0] - C.c) / 2.0;
            ret += SegCircleArea(C, sol[1], p[i+1]);
        }
    }
    return fabs(ret);
}


int n;
double x, y, v, ang, t, g, r;
Circle C;
Point p[maxn];


int main()
{
    while (scanf("%lf%lf%lf%lf%lf%lf%lf", &amp;x, &amp;y, &amp;v, &amp;ang, &amp;t, &amp;g, &amp;r))
    {
      if(x == 0 &amp;&amp; y == 0 &amp;&amp; v == 0 &amp;&amp; ang == 0 &amp;&amp; t == 0 &amp;&amp;  g == 0 &amp;&amp; r == 0) break;
      ang = torad(ang);
      C = Circle(Point(x + v*cos(ang)*t, y + v*sin(ang)*t - 0.5*g*t*t), r);


      scanf("%d", &amp;n);
      REP(i, n) scanf("%lf%lf", &amp;p[i].x, &amp;p[i].y);
      printf("%.2f\n", PolyCiclrArea(C, p, n));
    }
    return 0;
}
</pre>
<p>
</p>
<div style="padding-top:20px">
<p style="font-size:12px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<p>参考：http://blog.csdn.net/diary_yang/article/details/11166507</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-98154">
<article class="comment" id="comment-98154">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919520055" rel="external nofollow">新用户498576</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-98154" rel="nofollow"><time datetime="2017-04-20T11:47:09+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>超越党争，维护民族大义。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-98153">
<article class="comment" id="comment-98153">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919520055" rel="external nofollow">新用户498576</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-98153" rel="nofollow"><time datetime="2017-04-20T11:47:09+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>超越党争，维护民族大义。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-98152">
<article class="comment" id="comment-98152">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919520055" rel="external nofollow">新用户498576</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-98152" rel="nofollow"><time datetime="2017-04-20T11:47:09+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>超越党争，维护民族大义。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-98151">
<article class="comment" id="comment-98151">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919520055" rel="external nofollow">新用户498576</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-98151" rel="nofollow"><time datetime="2017-04-20T11:47:09+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>超越党争，维护民族大义。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-98150">
<article class="comment" id="comment-98150">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919520055" rel="external nofollow">新用户498576</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-98150" rel="nofollow"><time datetime="2017-04-20T11:47:09+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>超越党争，维护民族大义。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68055">
<article class="comment" id="comment-68055">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68055" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-68054">
<article class="comment" id="comment-68054">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68054" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68053">
<article class="comment" id="comment-68053">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68053" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-68052">
<article class="comment" id="comment-68052">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68052" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68051">
<article class="comment" id="comment-68051">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68051" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-68050">
<article class="comment" id="comment-68050">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68050" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68049">
<article class="comment" id="comment-68049">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919458398" rel="external nofollow">新用户763333</a></span> on <a href="http://www.acmerblog.com/hdu-4404-worms-7415.html#comment-68049" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大闹天竺，摆渡人，生化危机6等等新电影都没声音怎么看呀，赶紧修复一下，好多今年的新电影都是的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>