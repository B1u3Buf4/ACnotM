<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>07-16</div>
<div class="tit"><h1 class="entry-title">HDU 4418-Time travel-概率-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/math/number-theory" rel="category tag" title="查看数论应用中的全部文章">数论应用</a>, <a href="http://www.acmerblog.com/category/math/probability" rel="category tag" title="查看概率计算中的全部文章">概率计算</a></span><span class="i4">围观134次</span><span class="i3"><a class="ds-thread-count" data-thread-key="7431" href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comments" title="《HDU 4418-Time travel-概率-[解题报告]HOJ》上的评论">6 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Time travel</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
<center><img alt="Super Mario" src="http://www.acmerblog.com/img/1445677117526.jpg"/></center> <br/>Agent K is one of the greatest agents in a secret organization called Men in Black. Once he needs to finish a mission by traveling through time with the Time machine. The Time machine can take agent K to some point (0 to n-1) on the timeline and when he gets to the end of the time line he will come back (For example, there are 4 time points, agent K will go in this way 0, 1, 2, 3, 2, 1, 0, 1, 2, 3, 2, 1, …). But when agent K gets into the Time machine he finds it has broken, which make the Time machine can’t stop (Damn it!). Fortunately, the time machine may get recovery and stop for a few minutes when agent K arrives at a time point, if the time point he just arrive is his destination, he’ll go and finish his mission, or the Time machine will break again. The Time machine has probability Pk% to recover after passing k time points and k can be no more than M. We guarantee the sum of Pk is 100 (Sum(Pk) (1 &lt;= k &lt;= M)==100). Now we know agent K will appear at the point X(D is the direction of the Time machine: 0 represents going from the start of the timeline to the end, on the contrary 1 represents going from the end. If x is the start or the end point of the time line D will be -1. Agent K want to know the expectation of the amount of the time point he need to pass before he arrive at the point Y to finish his mission.<br/>If finishing his mission is impossible output "Impossible !" (no quotes )instead. </div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
There is an integer T (T &lt;= 20) indicating the cases you have to solve. The first line of each test case are five integers N, M, Y, X .D (0&lt; N,M &lt;= 100, 0 &lt;=X ,Y &lt; 100 ). The following M non-negative integers represent Pk in percentile. </div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
There is an integer T (T &lt;= 20) indicating the cases you have to solve. The first line of each test case are five integers N, M, Y, X .D (0&lt; N,M &lt;= 100, 0 &lt;=X ,Y &lt; 100 ). The following M non-negative integers represent Pk in percentile.</div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
2
4 2 0 1 0
50 50
4 1 0 2 1
100</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
8.14
2.00</pre>
<p> <!-- problem end --></p>
<p><span style="font-family:Arial; font-size:18px; line-height:26px; text-align:left">转载请注明出处，谢谢</span><a style="color:rgb(202,0,0); text-decoration:none; font-family:Arial; font-size:18px; line-height:26px; text-align:left"></a><a style="color:rgb(202,0,0); text-decoration:none; font-family:Arial; font-size:18px; line-height:26px; text-align:left">http://blog.csdn.net/acm_cxlove/article/details/7854526</a><span style="font-family:Arial; font-size:18px; line-height:26px; text-align:left">      <br/>
 by—cxlove </span></p>
<p><span style="font-family:Arial; font-size:18px; line-height:26px; text-align:left">题目：给出一个数轴，有一个起点和一个终点，某个人可以走1，2，3……m步，每一种情况有一个概率，初始有一个方向，走到头则返回，问到达终点的期望步数为多少。</span></p>
<p><span style="font-family:Arial; font-size:18px; line-height:26px; text-align:left"><a>http://acm.hdu.edu.cn/showproblem.php?pid=4418</a> <br/>
</span></p>
<p><span style="font-family:Arial; font-size:18px; line-height:26px; text-align:left">比较明显的高斯求期望问题。</span></p>
<p style="text-align:left"><span style="font-family:Arial; font-size:18px"><span style="line-height:26px">E[i]表示在i点的时候到达终点的期望步数，则E[i]=E[i+1]*p1+E[i+2]*p2+……E[i+m]*pm+1。</span></span></p>
<p style="text-align:left"><span style="font-family:Arial; font-size:18px"><span style="line-height:26px">列好方向 ，高斯消元即可。</span></span></p>
<p style="text-align:left"><span style="font-family:Arial; font-size:18px"><span style="line-height:26px">对于这种问题，注意无解情况，只需要先BFS一次，把有效的可行状态标号，即可</span></span></p>
<p style="text-align:left"><span style="font-family:Arial; font-size:18px"><span style="line-height:26px"></span></span></p>
<pre class="brush:cpp" name="code">#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;map&gt;
#include&lt;cstring&gt;
#include&lt;cmath&gt;
#include&lt;vector&gt;
#include&lt;algorithm&gt;
#include&lt;set&gt;
#include&lt;string&gt;
#include&lt;queue&gt;
#define inf 1&lt;&lt;28
#define M 6000005
#define N 205
#define maxn 300005
#define eps 1e-8
#define zero(a) fabs(a)&lt;eps
#define Min(a,b) ((a)&lt;(b)?(a):(b))
#define Max(a,b) ((a)&gt;(b)?(a):(b))
#define pb(a) push_back(a)
#define mem(a,b) memset(a,b,sizeof(a))
#define LL long long
#define lson step&lt;&lt;1
#define rson step&lt;&lt;1|1
using namespace std;
int n,m,y,x,s,d,e;
double p[N],a[N][N];
int cnt,id[N],g[N];
void debug(int n){
    for(int i=0;i&lt;n;i++){
        for(int j=0;j&lt;=n;j++)
           printf("%.2f ",a[i][j]);
        printf("\n");
    }
}
bool bfs(){
    queue&lt;int&gt;que;
    que.push(s);
    cnt=0;mem(id,-1);
    id[s]=cnt++;
    bool flag=false;
    while(!que.empty()){
        int u=que.front();que.pop();
        for(int i=1;i&lt;=m;i++){
            int v=(u+i)%(2*n-2);
            if(zero(p[i])) continue;
            if(id[v]!=-1) continue;
            id[v]=cnt++;
            if(g[v]==y) {flag=true;}
            que.push(v);
        }
    }
    return flag;
}
void Bulid(){
    mem(a,0);
    for(int i=0;i&lt;(2*n-2);i++){
        if(id[i]==-1) continue;
        int u=id[i];
        a[u][u]=1;
        if(g[i]==y){a[u][cnt]=0;continue;}
        for(int j=1;j&lt;=m;j++){
            int v=(i+j)%(2*n-2);
            if(id[v]==-1) continue;
            v=id[v];
            a[u][v]-=p[j];
            a[u][cnt]+=p[j]*j;
        }
    }
}
bool gauss(int n){
    int i,j;
    for(i=0,j=0;i&lt;n&amp;&amp;j&lt;n;j++){
        int k;
        for(k=i;k&lt;n;k++)
            if(!zero(a[k][j]))
                break;
        if(k&lt;n){
            if(i!=k)
            for(int r=j;r&lt;=n;r++) swap(a[i][r],a[k][r]);
            double tt=1/a[i][j];
            for(int r=j;r&lt;=n;r++)
                a[i][r]*=tt;
            for(int r=0;r&lt;n;r++)
                if(r!=i){
                    for(int t=n;t&gt;=j;t--)
                        a[r][t]-=a[r][j]*a[i][t];
                }
            i++;
        }
    }
    for(int r=i;r&lt;n;r++)
        if(!zero(a[r][n]))
            return false;
    return true;
}
int main(){
    int t;
    scanf("%d",&amp;t);
    while(t--){
        scanf("%d%d%d%d%d",&amp;n,&amp;m,&amp;y,&amp;x,&amp;d);
        for(int i=1;i&lt;=m;i++){scanf("%lf",&amp;p[i]);p[i]/=100.0;}
        if(x==y){printf("0.00\n");continue;}
        if(d==0)s=x;
        else if(d==1) s=n+(n-2-x);
        else s=x;
        for(int i=0;i&lt;n;i++) g[i]=i;
        for(int i=n,j=n-2;j&gt;=1;j--,i++) g[i]=j;
        if(!bfs()){puts("Impossible !");continue;}
        Bulid();
        if(!gauss(cnt)) puts("Impossible !");
        else{
            for(int i=0;i&lt;cnt;i++)
                if(zero(a[i][0]-1)){
                    double ans=a[i][cnt];
                    if(zero(ans)) printf("0.00\n");
                    else  printf("%.2f\n",ans);
                    break;
                }
        }
    }
    return 0;
}</pre>
<div style="padding-top:20px">
<p style="font-size:12px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<p>参考：http://blog.csdn.net/acm_cxlove/article/details/8039530</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-98078">
<article class="comment" id="comment-98078">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919529016" rel="external nofollow">新用户757982</a></span> on <a href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comment-98078" rel="nofollow"><time datetime="2017-04-20T11:47:08+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>我真不想告诉你所谓菲律宾离中国也很近的事，根本就是个流传多年的谣言</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-98077">
<article class="comment" id="comment-98077">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919529016" rel="external nofollow">新用户757982</a></span> on <a href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comment-98077" rel="nofollow"><time datetime="2017-04-20T11:47:08+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>我真不想告诉你所谓菲律宾离中国也很近的事，根本就是个流传多年的谣言</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-98076">
<article class="comment" id="comment-98076">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919529016" rel="external nofollow">新用户757982</a></span> on <a href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comment-98076" rel="nofollow"><time datetime="2017-04-20T11:47:08+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>我真不想告诉你所谓菲律宾离中国也很近的事，根本就是个流传多年的谣言</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-98075">
<article class="comment" id="comment-98075">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919529016" rel="external nofollow">新用户757982</a></span> on <a href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comment-98075" rel="nofollow"><time datetime="2017-04-20T11:47:08+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>我真不想告诉你所谓菲律宾离中国也很近的事，根本就是个流传多年的谣言</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-98074">
<article class="comment" id="comment-98074">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919529016" rel="external nofollow">新用户757982</a></span> on <a href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comment-98074" rel="nofollow"><time datetime="2017-04-20T11:47:08+00:00" pubdate="">2017年4月20日 at 上午11:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>我真不想告诉你所谓菲律宾离中国也很近的事，根本就是个流传多年的谣言</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68014">
<article class="comment" id="comment-68014">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919457459" rel="external nofollow">新用户417719</a></span> on <a href="http://www.acmerblog.com/hdu-4418-time-travel-7431.html#comment-68014" rel="nofollow"><time datetime="2017-04-11T03:57:02+00:00" pubdate="">2017年4月11日 at 上午3:57</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这个也太枪了吧………………</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>