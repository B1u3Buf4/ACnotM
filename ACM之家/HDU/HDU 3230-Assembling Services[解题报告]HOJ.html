<div class="c-top2" id="post-55">
<div class="datetime">2014<br/>03-09</div>
<div class="tit"><h1 class="entry-title">HDU 3230-Assembling Services[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a></span><span class="i4">围观435次</span><span class="i3"><a class="ds-thread-count" data-thread-key="5098" href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comments" title="《HDU 3230-Assembling Services[解题报告]HOJ》上的评论">14 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Assembling Services</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
In this problem, you need to simulate the execution of <i>n</i> service programs <i>P<sub>1</sub></i>, <i>P<sub>2</sub></i>, …, <i>P<sub>n</sub></i>. Each program is described with sequence of integers: <i>T I in<sub>1</sub> in<sub>2</sub> … in<sub>I</sub> O out<sub>1</sub> out<sub>2</sub> … out<sub>O</sub></i>, that means it takes <i>T</i> unit time to execute, needs <i>I</i> input variables (i.e. <i>in<sub>1</sub> in<sub>2</sub> … in<sub>I</sub></i>), and sets <i>O</i> output variables (i.e. <i>out<sub>1</sub> out<sub>2</sub> … out<sub>O</sub></i>) when it finishes running. A program can be started if and only if all these <i>T</i> input variables are ready (initially available, or set by some other programs).
<p>Imagine you have a super-computer which can execute as many programs in parallel as you like, and every variable can be read and written simultaneously by multiple programs. Your task is to calculate a particular "target" variable, as soon as possible.</p>
<p>Assume there are 4 programs, shown in the table below:</p>
<p></p><center><img alt="Jinyuetuan Puzzle" src="/img/1394721648723.jpg"/></center><br/>The quickest time to get <i>X<sub>5</sub></i> is 7, if only <i>X<sub>1</sub></i> is available at startup.
<p>You also need to construct an expression that shows <b>how to execute the programs to achieve the minimal time</b>. The grammar of the expression is recursive:
</p><ul>
<li><b>Single Program</b>: Px, where 1 &lt;= x &lt;= n. (i.e. P2, P499, etc). Meaning: execute the program immediately. Then end of this program marks the end of this expression.</li>
<p>
</p><li><b>Execute in serial</b>: (S1S2…Sk), where every Si is an expression. Note that the outermost pair of parentheses is mandatory. Meaning: execute expression S1, then S2 immediately after S1 ends, then S3 immediately after S2 ends, …, and finally Sk immediately after Sk-1 ends. Then end of expression Sk marks the end of the whole expression.</li>
<p>
</p><li><b> Execute in parallel</b>: (S1|S2|…|Sk), where every Si is an expression. Note that the outermost pair of parentheses is mandatory. Meaning: execute expressions S1, S2, …, and Sk simultaneously. The end of last finished expression marks the end of the whole expression.</li>
</ul>
<p>One of the possible expressions for the example above is (((P1P3)|P2)P4). (P1P2P3P4)is not acceptable, since <i>X<sub>5</sub></i> is available at time 10 in that expression, later than the optimal time 7. </p></div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
There will be at most 100 test cases. Each case begins with three integers <i>n, m, o</i>(1 &lt;= <i>n,m</i> &lt;= 500, 1 &lt;= <i>o</i> &lt;= <i>m</i>). The number of programs is <i>n</i>, the number of variables is <i>m</i>, and the target variable is <i>X<sub>o</sub></i>. Variables are numbered 1 to <i>m</i>, programs are numbered 1 to <i>n</i>. The next line contains a 01 string of <i>m</i> characters. The <i>i</i>-th character is 1 if and only if the <i>i</i>-th variable is initially available. The target variable is guaranteed to be unavailable at startup. The following <i>n</i> lines describe the programs. Each line begins with an integer <i>T</i>(1 &lt;= <i>T</i> &lt;= 100), the execution time, and an integer <i>I</i> followed by <i>I</i> integers <i>in<sub>1</sub>, in<sub>2</sub>, …, in<sub>I</sub></i>, as stated above, then an integer <i>O</i> followed by <i>O</i> integers <i>out<sub>1</sub>, out<sub>2</sub>, …, out<sub>O</sub></i>. 1 &lt;= <i>in<sub>i</sub>,out<sub>i</sub></i> &lt;= <i>m</i>, 1 &lt;= <i>I,O</i> &lt;= 10. The last test case is followed by <i>n=m=o=0</i>, which should not be processed. </div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
There will be at most 100 test cases. Each case begins with three integers <i>n, m, o</i>(1 &lt;= <i>n,m</i> &lt;= 500, 1 &lt;= <i>o</i> &lt;= <i>m</i>). The number of programs is <i>n</i>, the number of variables is <i>m</i>, and the target variable is <i>X<sub>o</sub></i>. Variables are numbered 1 to <i>m</i>, programs are numbered 1 to <i>n</i>. The next line contains a 01 string of <i>m</i> characters. The <i>i</i>-th character is 1 if and only if the <i>i</i>-th variable is initially available. The target variable is guaranteed to be unavailable at startup. The following <i>n</i> lines describe the programs. Each line begins with an integer <i>T</i>(1 &lt;= <i>T</i> &lt;= 100), the execution time, and an integer <i>I</i> followed by <i>I</i> integers <i>in<sub>1</sub>, in<sub>2</sub>, …, in<sub>I</sub></i>, as stated above, then an integer <i>O</i> followed by <i>O</i> integers <i>out<sub>1</sub>, out<sub>2</sub>, …, out<sub>O</sub></i>. 1 &lt;= <i>in<sub>i</sub>,out<sub>i</sub></i> &lt;= <i>m</i>, 1 &lt;= <i>I,O</i> &lt;= 10. The last test case is followed by <i>n=m=o=0</i>, which should not be processed.</div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
4 5 5
10000
2 1 1 1 2
3 1 1 1 3
4 1 2 1 4
1 2 3 4 1 5
1 2 1
01
31 1 2 1 1
3 5 5
10100
3 1 1 1 2
1 1 3 1 4
3 2 4 2 1 5
1 3 3
100
1 1 1 1 2
0 0 0</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
Case 1: 7 (((P1P3)|P2)P4)

Case 2: 31 P1

Case 3: 6 ((P1P3)|P2)

Case 4: -1

<div style="font-family:Times New Roman;font-size:14px;background-color:F4FBFF;border:#B7CBFF 1px dashed;padding:6px"><div style="font-family:Arial;font-weight:bold;color:#7CA9ED;border-bottom:#B7CBFF 1px dashed"><i>Hint</i></div><b>Explanation</b>

After a variable is set, it'll keep available forever. That's why P3 can be executed, in the third example.

Also note that there are some other correct expressions for the first sample, e.g.((P1P3P4)|P2). You can even print (((P1P3)P4)|P2) or ((P1(P3P4))|P2). Any one
 of them is acceptable in this problem.</div><i style="font-size:1px"> </i></pre>
<p> <!-- problem end --></p>
<pre class="brush:cpp ">//#pragma comment(linker,"/STACK:65536000")
#include&lt;stdio.h&gt;
#include&lt;string.h&gt;
#include&lt;iostream&gt;
#include&lt;algorithm&gt;
#include&lt;vector&gt;
#include&lt;stack&gt;
#include&lt;string&gt;
#include&lt;list&gt;
#include&lt;set&gt;
#include&lt;map&gt;
#include&lt;queue&gt;
#include &lt;math.h&gt;
#define clr(x,y) memset(x,y,sizeof(x))
#define forn(i,n) for(int i=0;i&lt;n;i++)
#define ll long long
#define mpr(x,y) make_pair(x,y)
#define pii pair&lt;int,int&gt;
#define MID ((l+r)&gt;&gt;1)
#define lson rt&lt;&lt;1,l,MID
#define rson rt&lt;&lt;1|1,MID+1,r
#define D(a) ((a)&gt;0?(a):-(a))
#define sqr(a) ((a)*(a))
#define lowb(i) ((i)&amp;(-i))
using namespace std;
const int inf=1&lt;&lt;30;

int n,m,o;
char a[10000];
int T[1000];
vector &lt;int&gt; in[1000],out[1000];
int num[1000];
int first[1000],next[1000],v[1000],ed;
void addedge(int u,int v){
    ::v[ed]=v;
    next[ed]=first[u];
    first[u]=ed++;
}
struct my{
    int x,d,s;
    my(int x=0,int d=0,int s=0):x(x),d(d),s(s){}
    bool operator &lt;(const my &amp;u)const{
        return s&gt;u.s;
    }
};
int ti=1;

string dfs(int u){
    string ans="(";
    if(u!=0){
        char b[10]="P";
        sprintf(b+1,"%d",u);
        ans+=b;
    }
    if(first[u]!=-1){
        ans+="(";
        int f=1;
        for(int i=first[u];~i;i=next[i]){
            if(f)f=0;
            else ans+="|";
            ans+=dfs(v[i]);
        }
        ans+=")";
    }
    ans+=")";
    if(ans.length()&gt;10000)while(1);
    return ans;
}
void gao(){
    priority_queue &lt;my&gt; que;
    bool vis[1000]={0};
    int dis[1000];
    for(int i=1;i&lt;=n;i++)dis[i]=inf;
    dis[0]=0;
    for(int i=1;i&lt;=n;i++){
        int flag=1;
        for(int j=0;j&lt;(int)in[i].size();j++)if(a[in[i][j]]=='0'){
            flag=0;break;
        }
        if(flag){
            vis[i]=1;
            addedge(0,i);
            dis[i]=min(dis[i],T[i]);
            que.push(my(i,T[i],dis[i]));
        }
    }
    int ans=-1;
    while(!que.empty()){
        my now=que.top();que.pop();
        int x=now.x;
        for(int i=0;i&lt;(int)out[x].size();i++){
            if(a[out[x][i]]!='1'){
                a[out[x][i]]='1';
                num[out[x][i]]=x;
            }
        }
        if(a[o]=='1'){
            ans=dis[x];
            break;
        }
        for(int i=1;i&lt;=n;i++)if(!vis[i]){
            int flag=1;
            for(int j=0;j&lt;(int)in[i].size();j++)if(a[in[i][j]]=='0'){
                flag=0;break;
            }
            if(flag){
                vis[i]=1;
                int p=0;
//                addedge(x,i);
                int ret=0;
                for(int j=0;j&lt;(int)in[i].size();j++)if(dis[num[in[i][j]]]&gt;ret)ret=dis[num[in[i][j]]],p=num[in[i][j]];
                addedge(p,i);
                dis[i]=min(dis[i],ret+T[i]);
                que.push(my(i,T[i],dis[i]));
            }
        }
    }
//    for(int i=0;i&lt;=n;i++){
//        printf("%d : ",i);
//        for(int j=first[i];~j;j=next[j])printf("%d ",v[j]);
//        puts("");
//    }
    if(ans!=-1){
        printf("Case %d: %d ",ti++,ans);
        cout&lt;&lt;dfs(0)&lt;&lt;endl;

    }
    else printf("Case %d: %d\n",ti++,ans);
    puts("");
}
int main(){
//    freopen("/home/axorb/in","r",stdin);
    while(scanf("%d%d%d",&amp;n,&amp;m,&amp;o),n+m+o){
        scanf("%s",a+1);
        ed=0;
        clr(first,-1);
        clr(num,0);
        for(int i=1;i&lt;=m;i++)if(a[i]=='1')num[i]=0;
        for(int i=1;i&lt;=n;i++){
            scanf("%d",T+i);
            in[i].clear();
            out[i].clear();
            int p;
            scanf("%d",&amp;p);
            for(int j=0;j&lt;p;j++){
                int q;
                scanf("%d",&amp;q);
                in[i].push_back(q);
            }
            scanf("%d",&amp;p);
            for(int j=0;j&lt;p;j++){
                int q;
                scanf("%d",&amp;q);
                out[i].push_back(q);
            }
        }
        gao();
    }
}</pre>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-78323">
<article class="comment" id="comment-78323">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919512868" rel="external nofollow">新用户940332</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-78323" rel="nofollow"><time datetime="2017-04-12T10:53:30+00:00" pubdate="">2017年4月12日 at 上午10:53</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>IE8加火狐~！  </p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28121">
<article class="comment" id="comment-28121">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">yupeng.bai</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28121" rel="nofollow"><time datetime="2015-06-26T11:35:11+00:00" pubdate="">2015年6月26日 at 上午11:35</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>终于找到一篇能看懂的，mark</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28118">
<article class="comment" id="comment-28118">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">MyHome</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28118" rel="nofollow"><time datetime="2015-04-05T14:09:13+00:00" pubdate="">2015年4月5日 at 下午2:09</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>很好的思路，可以借鉴</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-48112">
<article class="comment" id="comment-48112">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">tufei</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-48112" rel="nofollow"><time datetime="2015-02-24T14:36:27+00:00" pubdate="">2015年2月24日 at 下午2:36</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>This write-up presents the gentle in which we can notice the fact. this is extremely wonderful one and gives in depth info.</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-48111">
<article class="comment" id="comment-48111">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">Lanifer</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-48111" rel="nofollow"><time datetime="2015-02-19T04:52:46+00:00" pubdate="">2015年2月19日 at 上午4:52</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>L（X [0 .. M-1]，Y [0 .. N-1]）= 1 + L（X [0 .. M-2]，Y [0 .. N-1]）这个地方也也有笔误<br/>
应改为L（X [0 .. M-1]，Y [0 .. N-1]）= 1 + L（X [0 .. M-2]，Y [0 .. N-2]）</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-48113">
<article class="comment" id="comment-48113">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">HenrryCheng</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-48113" rel="nofollow"><time datetime="2015-01-26T13:16:59+00:00" pubdate="">2015年1月26日 at 下午1:16</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>红绯鱼：<br/>
牛逼牛逼</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28115">
<article class="comment" id="comment-28115">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">zhenghao</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28115" rel="nofollow"><time datetime="2015-01-25T23:51:22+00:00" pubdate="">2015年1月25日 at 下午11:51</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>居然看懂了</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-48109">
<article class="comment" id="comment-48109">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">H.Watson</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-48109" rel="nofollow"><time datetime="2014-09-29T08:47:26+00:00" pubdate="">2014年9月29日 at 上午8:47</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>头文件的颜色是有意设成这种灰暗色的吗？感觉看不清</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-48110">
<article class="comment" id="comment-48110">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">Emlar</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-48110" rel="nofollow"><time datetime="2014-06-28T20:38:56+00:00" pubdate="">2014年6月28日 at 下午8:38</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>不太懂呀，乡亲们。原理知道代码不会</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28117">
<article class="comment" id="comment-28117">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">jue</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28117" rel="nofollow"><time datetime="2014-05-25T18:23:57+00:00" pubdate="">2014年5月25日 at 下午6:23</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>第二个方法挺不错。NewHead代表新的头节点，通过递归找到最后一个节点之后，就把这个节点赋给NewHead，然后一直返回返回，中途这个值是没有变化的，一边返回一边把相应的指针方向颠倒，最后结束时返回新的头节点到主函数。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28122">
<article class="comment" id="comment-28122">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">litao</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28122" rel="nofollow"><time datetime="2014-04-26T18:05:36+00:00" pubdate="">2014年4月26日 at 下午6:05</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>博主的C++功底真是好</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28116">
<article class="comment" id="comment-28116">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">bluesky</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28116" rel="nofollow"><time datetime="2014-04-22T06:45:58+00:00" pubdate="">2014年4月22日 at 上午6:45</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>以了解 想問為甚麼 Tbl[6001] = {1} 初始化都是1<br/>
為何不是Tbl[0]=1 其他為0</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28120">
<article class="comment" id="comment-28120">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">liuyuedeyu</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28120" rel="nofollow"><time datetime="2014-04-16T18:43:39+00:00" pubdate="">2014年4月16日 at 下午6:43</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>刚开始学，非常好</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28119">
<article class="comment" id="comment-28119">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">abguorui0928</a></span> on <a href="http://www.acmerblog.com/hdu-3230-assembling-services-5098.html#comment-28119" rel="nofollow"><time datetime="2014-04-02T11:37:52+00:00" pubdate="">2014年4月2日 at 上午11:37</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>此题的样例描述不正确</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>