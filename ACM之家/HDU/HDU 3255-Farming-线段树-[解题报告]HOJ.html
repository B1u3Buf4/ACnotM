<div class="c-top2" id="post-55">
<div class="datetime">2014<br/>03-13</div>
<div class="tit"><h1 class="entry-title">HDU 3255-Farming-线段树-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/data-struct/trees" rel="category tag" title="查看树形结构中的全部文章">树形结构</a>, <a href="http://www.acmerblog.com/category/geometry/analytic-geometry" rel="category tag" title="查看解析几何中的全部文章">解析几何</a></span><span class="i4">围观542次</span><span class="i3"><a class="ds-thread-count" data-thread-key="5150" href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comments" title="《HDU 3255-Farming-线段树-[解题报告]HOJ》上的评论">18 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Farming</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
You have a big farm, and you want to grow vegetables in it. You’re too lazy to seed the seeds yourself, so you’ve hired n people to do the job for you.<br/>Each person works in a rectangular piece of land, seeding one seed in one unit square. The working areas of different people may overlap, so one unit square can be seeded several times. However, due to limited space, different seeds in one square fight each other — finally, the most powerful seed wins. If there are several "most powerful" seeds, one of them win (it does not matter which one wins).
<p>There are m kinds of seeds. Different seeds grow up into different vegetables and sells for different prices. <br/>As a rule, more powerful seeds always grow up into more expensive vegetables.<br/>Your task is to calculate how much money will you get, by selling all the vegetables in the whole farm. </p></div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
The first line contains a single integer T (T &lt;= 10), the number of test cases. <br/>Each case begins with two integers n, m (1 &lt;= n &lt;= 30000, 1 &lt;= m &lt;= 3).<br/>The next line contains m distinct positive integers p<sub>i</sub> (1 &lt;= p<sub>i</sub> &lt;= 100), the prices of each kind of vegetable. <br/>The vegetables (and their corresponding seeds) are numbered 1 to m in the order they appear in the input. <br/>Each of the following n lines contains five integers x1, y1, x2, y2, s, indicating a working seeded a rectangular area with lower-left corner (x1,y1), upper-right corner (x2,y2), with the s-th kind of seed.<br/>All of x1, y1, x2, y2 will be no larger than 10<sup>6</sup> in their absolute values. </div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
The first line contains a single integer T (T &lt;= 10), the number of test cases. <br/>Each case begins with two integers n, m (1 &lt;= n &lt;= 30000, 1 &lt;= m &lt;= 3).<br/>The next line contains m distinct positive integers p<sub>i</sub> (1 &lt;= p<sub>i</sub> &lt;= 100), the prices of each kind of vegetable. <br/>The vegetables (and their corresponding seeds) are numbered 1 to m in the order they appear in the input. <br/>Each of the following n lines contains five integers x1, y1, x2, y2, s, indicating a working seeded a rectangular area with lower-left corner (x1,y1), upper-right corner (x2,y2), with the s-th kind of seed.<br/>All of x1, y1, x2, y2 will be no larger than 10<sup>6</sup> in their absolute values.</div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
2
1 1
25
0 0 10 10 1
2 2
5 2
0 0 2 1 1
1 0 3 2 2</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
Case 1: 2500
Case 2: 16</pre>
<p> <!-- problem end --></p>
<p>题目链接：http://acm.hdu.edu.cn/showproblem.php?pid=3255</p>
<p> </p>
<p>题目大意：给你多块蔬菜地，蔬菜地有重叠部分，每部分种的蔬菜可能相同也可能不同，重叠部分种植蔬菜价值最贵的，最后让你求最大利润。</p>
<p> </p>
<p>解题思路：</p>
<p>     这是我做的最坑爹的一题，几乎让我快哭了，Wrong answer了三十多次， 重拍了五六次代码。</p>
<p>     每块蔬菜地种植蔬菜收获的利润为 val=x*y*price。  面积乘以价格，题目的重点转换在于如何确定重叠区域怎么让它种植最贵的蔬菜。</p>
<p>     观察利润计算公式 :   x*y*price &lt;==&gt; x*y*h    可以转换为求体积并。</p>
<p>     说实话，这题一看真的很简单，一交就是一直错，代码每个部分都有调试N遍。 昨天一个就一直在调试，五个小时无果。和别人一对照，思路一点都没错，今天下午再重拍了一遍代码，又开始了Wrong answer之路，然后带着那颗受伤的心去改数组范围。点最大3W， 我线段树开12W多，存X的点开6W多。 点开4W错， 6WTLE， 索性所有数组范围开150005，错。 150101 AC。 我想哭了…..</p>
<p> </p>
<p><img alt="Farming" id="code_img_closed_16fb96dd-e236-46fc-a137-18bac77a54fb" src="/img/1395043068321.gif"/><img alt="Farming" id="code_img_opened_16fb96dd-e236-46fc-a137-18bac77a54fb" onclick="cnblogs_code_hide('16fb96dd-e236-46fc-a137-18bac77a54fb',event)" src="/img/1395043068411.gif" style="display: none;"/><span>View Code </span></p>
<pre class="brush:cpp ">#include &lt;iostream&gt;
 #include &lt;cstdio&gt;
 #include &lt;cstring&gt;
 #include &lt;algorithm&gt;
 using namespace std;
 
 #define lson l,mid,ID&lt;&lt;1
 #define rson mid+1,r,ID&lt;&lt;1|1
 const int maxn=150101;
 typedef long long lld;
 int flag[maxn];
 lld sum[maxn];
 int X[maxn], Z[maxn];
 
 struct Node   ///这题快把我整哭了
 {
     int lx, rx, y, z, s;
     Node(){}
     Node(int lx_, int rx_ , int y_, int z_, int s_)
     {
         lx=lx_, rx=rx_, y=y_, z=z_, s=s_;
     }
     bool operator&lt;(const Node &amp;S) const
     {
         if(y==S.y) return s&gt;S.s;
         else return y&lt;S.y;
     }
 }line[maxn], tmp[maxn];
 
 
 int find(int x, int M)
 {
     int l,r,m;
     l=1;
     r=M;
     while(l&lt;=r)
     {
         m=(l+r)&gt;&gt;1;
         if(X[m]==x)
             return m;
         if(X[m]&lt;x)
             l=m+1;
         else
             r=m-1;
     }
 }
 void Push_up(int ID,int l,int r)
 {
     if(flag[ID])sum[ID]=X[r+1]-X[l];
     else if(l==r)sum[ID]=0;
     else sum[ID]=sum[ID&lt;&lt;1]+sum[ID&lt;&lt;1|1];
 }
 void Update(int x,int y,int z,int l,int r,int ID)
 {
     int mid;
     if(x&lt;=l&amp;&amp;r&lt;=y)
     {
         flag[ID]+=z;
         Push_up(ID,l,r);
         return ;
     }
     mid=(l+r)&gt;&gt;1;
     if(x&lt;=mid)
         Update(x,y,z,lson);
     if(y&gt;mid)
         Update(x,y,z,rson);
     Push_up(ID,l,r);
 }
 
 int main()
 {
     int n, m, T, tcase=0;
     cin &gt;&gt; T;
     while(T--)
     {
         cin &gt;&gt; n &gt;&gt; m;
         Z[0]=0;
         for(int i=1; i&lt;=m; i++)
             cin &gt;&gt; Z[i];
         int num=0;
         for(int i=0; i&lt;n; i++)
         {
             int x1, x2, y1, y2, id;
             scanf("%d%d%d%d%d",&amp;x1,&amp;y1,&amp;x2,&amp;y2,&amp;id);
             line[++num]=Node(x1,x2,y1,Z[id],1);
             X[num]=x1;
             line[++num]=Node(x1,x2,y2,Z[id],-1);
             X[num]=x2;
         }
         sort(Z,Z+m+1);
         sort(X+1,X+num+1);
         sort(line+1,line+num+1);
         int ep=1;
         for(int i=2; i&lt;=num; i++)
             if(X[i]!=X[ep]) X[++ep]=X[i];
         lld ans=0;
         for(int i=0; i&lt;m; i++)
         {
             memset(sum,0,sizeof(sum));
             memset(flag,0,sizeof(flag));
             lld tp=0, cnt=0;
             for(int j=1; j&lt;=num; j++)
                if(line[j].z&gt;Z[i]) tmp[++cnt]=line[j];
             for(int j=1; j&lt;cnt; j++)
             {
                 int l=find(tmp[j].lx,ep);
                 int r=find(tmp[j].rx,ep)-1;
                 Update(l,r,tmp[j].s,1,ep-1,1);
                 tp+=sum[1]*(lld)(tmp[j+1].y-tmp[j].y);
             }
             ans+=tp*(lld)(Z[i+1]-Z[i]);
         }
         printf("Case %d: %I64d\n",++tcase,ans);
     }
     return 0;
 }</pre>
<p> </p>
<p>参考：http://www.cnblogs.com/kane0526/archive/2013/03/07/2948446.html</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-78286">
<article class="comment" id="comment-78286">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919532679" rel="external nofollow">新用户810512</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-78286" rel="nofollow"><time datetime="2017-04-12T10:53:29+00:00" pubdate="">2017年4月12日 at 上午10:53</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>严谨的叫科学，自由散漫的叫艺术。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-78285">
<article class="comment" id="comment-78285">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919532679" rel="external nofollow">新用户810512</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-78285" rel="nofollow"><time datetime="2017-04-12T10:53:29+00:00" pubdate="">2017年4月12日 at 上午10:53</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>严谨的叫科学，自由散漫的叫艺术。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-78284">
<article class="comment" id="comment-78284">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919532679" rel="external nofollow">新用户810512</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-78284" rel="nofollow"><time datetime="2017-04-12T10:53:29+00:00" pubdate="">2017年4月12日 at 上午10:53</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>严谨的叫科学，自由散漫的叫艺术。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-78283">
<article class="comment" id="comment-78283">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919532679" rel="external nofollow">新用户810512</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-78283" rel="nofollow"><time datetime="2017-04-12T10:53:29+00:00" pubdate="">2017年4月12日 at 上午10:53</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>严谨的叫科学，自由散漫的叫艺术。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28305">
<article class="comment" id="comment-28305">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">Lin</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28305" rel="nofollow"><time datetime="2015-05-14T13:20:51+00:00" pubdate="">2015年5月14日 at 下午1:20</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>信息不全</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28303">
<article class="comment" id="comment-28303">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">JcZ</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28303" rel="nofollow"><time datetime="2015-05-09T03:59:21+00:00" pubdate="">2015年5月9日 at 上午3:59</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>&amp;amp;这是C语言？</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28300">
<article class="comment" id="comment-28300">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">lintong</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28300" rel="nofollow"><time datetime="2015-04-10T01:09:23+00:00" pubdate="">2015年4月10日 at 上午1:09</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>博主的C++功底真是好</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28309">
<article class="comment" id="comment-28309">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">tangxiansheng</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28309" rel="nofollow"><time datetime="2015-03-31T14:55:26+00:00" pubdate="">2015年3月31日 at 下午2:55</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>感谢分享 学习了`(*∩_∩*)′</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28302">
<article class="comment" id="comment-28302">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">_Tree</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28302" rel="nofollow"><time datetime="2015-03-10T01:59:42+00:00" pubdate="">2015年3月10日 at 上午1:59</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>大致看了下，算法的时间复杂度没有很本性的提升，算不上高效。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28304">
<article class="comment" id="comment-28304">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">HenrryCheng</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28304" rel="nofollow"><time datetime="2015-02-21T17:30:44+00:00" pubdate="">2015年2月21日 at 下午5:30</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>第二个方法好！</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28308">
<article class="comment" id="comment-28308">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">aaa</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28308" rel="nofollow"><time datetime="2014-12-26T17:56:40+00:00" pubdate="">2014年12月26日 at 下午5:56</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>太变态了。我用hash居然超时了。这样break掉居然都行啊。。。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28301">
<article class="comment" id="comment-28301">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">leowww</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28301" rel="nofollow"><time datetime="2014-11-14T11:17:44+00:00" pubdate="">2014年11月14日 at 上午11:17</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这个方法是错的，不信你试试：<br/>
20 5<br/>
1 A:9<br/>
1 A:9<br/>
1 A:9<br/>
1 A:6<br/>
1 A:4<br/>
正确答案应该是19，这个答案是18</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28299">
<article class="comment" id="comment-28299">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">litaotao</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28299" rel="nofollow"><time datetime="2014-09-08T18:54:31+00:00" pubdate="">2014年9月8日 at 下午6:54</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>很好的思路，可以借鉴</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28311">
<article class="comment" id="comment-28311">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">Ding Qiangyuan</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28311" rel="nofollow"><time datetime="2014-08-20T09:25:24+00:00" pubdate="">2014年8月20日 at 上午9:25</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>先从简单的做起，归并排序，二叉树相关的遍历等</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28306">
<article class="comment" id="comment-28306">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">hwp</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28306" rel="nofollow"><time datetime="2014-08-05T01:32:07+00:00" pubdate="">2014年8月5日 at 上午1:32</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>int L[m+1][n+1];这样定义出错，这个在gcc上可以编译通过 在VS上不行 应该改为new 或者vector</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28312">
<article class="comment" id="comment-28312">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">sharp</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28312" rel="nofollow"><time datetime="2014-07-31T10:58:40+00:00" pubdate="">2014年7月31日 at 上午10:58</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>…. 配图居然是没方向的。。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-28310">
<article class="comment" id="comment-28310">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">211206421</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28310" rel="nofollow"><time datetime="2014-06-09T12:23:58+00:00" pubdate="">2014年6月9日 at 下午12:23</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这一题的代码这样提交时错误的~少考虑了很多情况</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-28307">
<article class="comment" id="comment-28307">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">litaotao</a></span> on <a href="http://www.acmerblog.com/hdu-3255-farming-5150.html#comment-28307" rel="nofollow"><time datetime="2014-06-01T21:36:34+00:00" pubdate="">2014年6月1日 at 下午9:36</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>Dijkstra 不适合有负权值的边吧</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>