<div class="c-top2" id="post-55">
<div class="datetime">2015<br/>04-13</div>
<div class="tit"><h1 class="entry-title">HDU 3842-Machine Works-分治-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/basis/sort" rel="category tag" title="查看排序中的全部文章">排序</a>, <a href="http://www.acmerblog.com/category/basis/recursion" rel="category tag" title="查看递归和分治中的全部文章">递归和分治</a></span><span class="i4">围观385次</span><span class="i3"><a class="ds-thread-count" data-thread-key="6844" href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comments" title="《HDU 3842-Machine Works-分治-[解题报告]HOJ》上的评论">13 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Machine Works</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
You are the director of Arbitrarily Complex Machines (ACM for short), a company producing advanced machinery using even more advanced machinery. The old production machinery has broken down, so you need to buy new production machines for the company. Your goal is to make as much money as possible during the restructuring period. During this period you will be able to buy and sell machines and operate them for profit while ACM owns them. Due to space restrictions, ACM can own at most one machine at a time.
<p>During the restructuring period, there will be several machines for sale. Being an expert in the advanced machines market, you already know the price P<sub>i</sub> and the availability day Di for each machines M<sub>i</sub>. Note that if you do not buy machine M<sub>i</sub> on day Di, then somebody else will buy it and it will not be available later. Needless to say, you cannot buy a machine if ACM has less money than the price of the machine.</p>
<p>If you buy a machine M<sub>i</sub> on day D<sub>i</sub>, then ACM can operate it starting on day D<sub>i</sub> + 1. Each day that the machine operates, it produces a profit of Gi dollars for the company.</p>
<p>You may decide to sell a machine to reclaim a part of its purchase price any day after you’ve bought it. Each machine has a resale price R<sub>i</sub> for which it may be resold to the market. You cannot operate a machine on the day that you sell it, but you may sell a machine and use the proceeds to buy a new machine on the same day.</p>
<p>Once the restructuring period ends, ACM will sell any machine that it still owns. Your task is to maximize the amount of money that ACM makes during the restructuring. </p></div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
The input consists of several test cases. Each test case starts with a line containing three positive integers N, C, and D. N is the number of machines for sale (N &lt;= 10^5), C is the number of dollars with which the company begins the restructuring (C &lt;= 10^9), and D is the number of days that the restructuring lasts (D &lt;= 10^9).
<p>Each of the next N lines describes a single machine for sale. Each line contains four integers D<sub>i</sub>, P<sub>i</sub>, R<sub>i</sub> and G<sub>i</sub>,<br/>denoting (respectively) the day on which the machine is for sale, the dollar price for which it may be bought, the<br/>dollar price for which it may be resold and the daily profit generated by operating the machine. These numbers satisfy<br/>1 &lt;= D<sub>i</sub> &lt;= D, 1 &lt;= R<sub>i</sub> &lt; P<sub>i</sub> &lt;=10^9 and 1 &lt;= G<sub>i</sub> &lt;= 10^9.</p>
<p>The last test case is followed by a line containing three zeros. </p></div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
The input consists of several test cases. Each test case starts with a line containing three positive integers N, C, and D. N is the number of machines for sale (N &lt;= 10^5), C is the number of dollars with which the company begins the restructuring (C &lt;= 10^9), and D is the number of days that the restructuring lasts (D &lt;= 10^9).
<p>Each of the next N lines describes a single machine for sale. Each line contains four integers D<sub>i</sub>, P<sub>i</sub>, R<sub>i</sub> and G<sub>i</sub>,<br/>denoting (respectively) the day on which the machine is for sale, the dollar price for which it may be bought, the<br/>dollar price for which it may be resold and the daily profit generated by operating the machine. These numbers satisfy<br/>1 &lt;= D<sub>i</sub> &lt;= D, 1 &lt;= R<sub>i</sub> &lt; P<sub>i</sub> &lt;=10^9 and 1 &lt;= G<sub>i</sub> &lt;= 10^9.</p>
<p>The last test case is followed by a line containing three zeros.</p></div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
6 10 20
6 12 1 3
1 9 1 2
3 2 1 2
8 20 5 4
4 11 7 4
2 10 9 1
0 0 0</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
Case 1: 44</pre>
<p> <!-- problem end --></p>
<p>本题是利用cdq分治  实现斜率优化的一个题目</p>
<p>斜率优化之前做的几个题都是斜率单调，并且插入点时由于点在某一维单调，所以仅仅操作队首和队尾就能完成优化了</p>
<p>但是本题显然不是 </p>
<p>
</p>
<p>主要参考了两个东西</p>
<p>从《Cash》谈一类分治算法的应用
</p>
<p>(Day1)cdq分治相关
</p>
<p>这两个直接在百度上搜 ，第一个出来的就是</p>
<p>
</p>
<p>本题的题意是</p>
<p>一个公司获得了一个厂房n(10^5)天的使用权<br/>
和一笔启动资金C(10^9)，准备在n天里租借机器生产来获得收益<br/>
可以租借的机器有M(10^5)个，每个机器有四个值，D,P,R,G (D&lt;=n, P,R,G都是10^9)<br/>
表明你可以再第D天花费P费用（首先手里必须有那么多钱）<br/>
租借这个机器，从D+1天开始该机器每天产生G的收益，在你不需要机器时<br/>
可以卖掉这个机器，一次获得R的钱</p>
<p>
需要注意的是：<br/>
厂房里只能停留一台机器<br/>
不能再购买和卖出机器的那天操作机器，但是可以再同一天卖掉一台机器再买一台<br/>
在第n+1天，必须卖掉手里的机器<br/>
问n+1天后能获得的最大资金
</p>
<p>
</p>
<p>根据这个题意</p>
<p>我们可以得到一个dp转移方程</p>
<p>首先要想的问题是是否有场地就要放机器</p>
<p>最开始的时候肯定不是这样，因为怕买到坑的机器很可能会亏钱，但是假设你买到了一台好的机器，在下一个机器进来之前，你肯定是一直运转下去的</p>
<p>然后得把所有的时间都离散化，就是每个机器的D</p>
<p>然后用f[i]表示在D[i]时刻卖掉手里的机器手里最多多少钱</p>
<p>f[i] = max(f[i - 1], f[j] – P[j] + R[j] + G[j] * (D[i] – D[j]  - 1))</p>
<p>其中f[j] &gt;= P[j]</p>
<p>可以看出是O(n^2)的，显然不行啊</p>
<p>令h[j] = f[j] + R[j]- P[j] – G[j] * (D[j] + 1)</p>
<p>式子就变成  f[i] = h[j] + D[i] * G[j]</p>
<p>即h[j] = -D[i] * G[j] + f[i] </p>
<p>对于这个， 可以抽象成一个二维空间</p>
<p>由(G[j],h[j])作为点集, -D[i]为斜率</p>
<p>然后求使得截距最大的那个，就是f[i]最大了</p>
<p>观察这些点集</p>
<p>可以发现，一点都不单调啊，就需要按照G[j]这一维做个排序</p>
<p>使得他至少在一维上单调，方便我们做插入和删除操作</p>
<p>然后由于斜率是单调递减的，并且是负数</p>
<p>可以画一画，最后要维护的最优点的点集，在图上形成的是一条上凸的线</p>
<p><img alt="Machine Works" src="http://cdn.acmerblog.com/img/1436123044988.png"/>
</p>
<p>然后每插一个点都是维护这个图形
</p>
<p>
</p>
<p>然后这个排序，你在普通的DP方法里肯定是不能每次都去排序的</p>
<p>这就需要cdq分治了</p>
<p>对于一个区间l,r</p>
<p>你先更新了l,mid</p>
<p>然后对左边这部分的区间的点集， 进行排序，形成上面这个图形</p>
<p>然后更新右边区间的时候，</p>
<p>由于斜率是递减的，你可以发现，我们只需要扫一遍这个图形即可完成所有右边区间值的更新</p>
<p>然后就这样递归着去更新</p>
<p>完成cdq分治</p>
<p>
</p>
<p>总体复杂度，应该是nlognlogn</p>
<p>因为每个子区间中都有这个排序</p>
<p>代码还是参照xiaodao的，因为实在是不熟悉这个方法。</p>
<p>需要留意的是，在斜率之间做比较的时候，如果用乘法来比较的话，会溢出long long</p>
<p>
</p>
<pre class="brush:cpp" code_snippet_id="514034" name="code" snippet_file_name="blog_20141110_1_7557511">#include &lt;iostream&gt;
#include &lt;cstring&gt;
#include &lt;cstdio&gt;
#include &lt;algorithm&gt;
#include &lt;cstdlib&gt;
#include &lt;ctime&gt;
#include &lt;set&gt;
#include &lt;vector&gt;
#include &lt;map&gt;
#define MAXN 11111
#define MAXM 55555
#define INF 1000000007
using namespace std;
long long f[111111];
struct node {
    int d, p, g, r;
}p[111111];
bool cmp(node x, node y) {
    return x.d &lt; y.d;
}
int n, d;
typedef pair&lt;int, long long&gt; PA;
PA A[111111], C[111111];
long long h(int j) {
    return f[j] + (long long)p[j].r - (long long)p[j].p - (long long)p[j].g * (long long)(p[j].d + 1);
}
int slopecomp(PA a, PA b, PA c) {
    long long xa = b.first - a.first;
    long long xb = c.first - a.first;
    long long ya = b.second - a.second;
    long long yb = c.second - a.second;
    double tmp = (double)xa * yb - (double)xb * ya;
    return tmp &lt; 0;
}
void cdq(int l, int r) {
    if(l + 1 &lt;= r) {
        int m = (l + r) &gt;&gt; 1;
        cdq(l, m);
        int na = 0, nb = 0, nc = 0;
        for(int j = l; j &lt;= m; j++) {
            if(f[j] &gt;= p[j].p) A[na++] = PA(p[j].g, h(j));
        }
        sort(A, A + na);
        for(int i = 0; i &lt; na; i++) {
            while(nc &gt; 1 &amp;&amp; !slopecomp(C[nc - 1], C[nc], A[i])) nc--;
            C[++nc] = A[i];
        }
        int j = 0;
        for(int i = m + 1; i &lt;= r; i++) {
            long long a1, a2, b1, b2, x;
            x = p[i].d;
            while(j &lt; nc) {
                a1 = C[j].first;
                a2 = C[j + 1].first;
                b1 = C[j].second;
                b2 = C[j + 1].second;
                if(a1 * x + b1 &gt;= a2 * x + b2) break;
                j++;
            }
            f[i] = max(f[i], (long long)C[j].first * x + C[j].second);
        }

        cdq(m + 1, r);
    }
}
int main() {
    int cas = 0;
    while(scanf("%d%I64d%d", &amp;n, &amp;f[0], &amp;d) != EOF) {
        if(n == 0 &amp;&amp; f[0] == 0 &amp;&amp; d == 0) break;
        for(int i = 1; i &lt;= n; i++) scanf("%d%d%d%d", &amp;p[i].d, &amp;p[i].p, &amp;p[i].r, &amp;p[i].g);
        sort(p + 1, p + n + 1, cmp);
        ++n;
        p[n].d = d + 1;
        p[n].g = p[n].p = 0;
        for(int i = 1; i &lt;= n; i++) f[i] = f[0];
        cdq(0, n);
        printf("Case %d: %I64d\n", ++cas, f[n]);
    }
    return 0;
}</pre>
<div style="padding-top:20px">
<p style="font-size:12px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<p>参考：http://blog.csdn.net/sdj222555/article/details/40919903</p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-72308">
<article class="comment" id="comment-72308">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919457017" rel="external nofollow">新用户310894</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-72308" rel="nofollow"><time datetime="2017-04-11T17:41:14+00:00" pubdate="">2017年4月11日 at 下午5:41</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>我想让一个人说完=-=，而且好搭楼。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-34205">
<article class="comment" id="comment-34205">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">crazymage</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34205" rel="nofollow"><time datetime="2015-07-12T13:28:07+00:00" pubdate="">2015年7月12日 at 下午1:28</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>“再把所有不和该节点相邻的节点着相同的颜色”，程序中没有进行不和该节点相邻的其他节点是否相邻进行判断。再说求出来的也不一样是颜色数最少的</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-34204">
<article class="comment" id="comment-34204">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">CCat</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34204" rel="nofollow"><time datetime="2015-07-10T04:25:38+00:00" pubdate="">2015年7月10日 at 上午4:25</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>能不能说下这个是用的什么算法策略？</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-34203">
<article class="comment" id="comment-34203">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">mr-zhang2011</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34203" rel="nofollow"><time datetime="2015-06-27T13:38:07+00:00" pubdate="">2015年6月27日 at 下午1:38</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>漂亮。佩服。<br/>
P.S.  unsigned 应该去掉。换行符是n 不是/n<br/>
还可以稍微优化一下，<br/>
int main() {<br/>
	int m,n,ai,aj,bi,bj,ak,bk;<br/>
	while (scanf("%d%d",&amp;m,&amp;n)!=EOF) {<br/>
		ai = sqrt(m-1);<br/>
		bi = sqrt(n-1);<br/>
		aj = (m-ai*ai-1)&gt;&gt;1;<br/>
		bj = (n-bi*bi-1)&gt;&gt;1;<br/>
		ak = ((ai+1)*(ai+1)-m)&gt;&gt;1;<br/>
		bk = ((bi+1)*(bi+1)-n)&gt;&gt;1;<br/>
		printf("%dn",abs(ai-bi)+abs(aj-bj)+abs(ak-bk));<br/>
	}<br/>
}</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-34207">
<article class="comment" id="comment-34207">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">tonight</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34207" rel="nofollow"><time datetime="2015-06-21T09:13:09+00:00" pubdate="">2015年6月21日 at 上午9:13</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>厉害啊，我遇见数学问题就头疼！</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-34206">
<article class="comment" id="comment-34206">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">gaotongtest</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34206" rel="nofollow"><time datetime="2015-06-20T21:04:51+00:00" pubdate="">2015年6月20日 at 下午9:04</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这怎么用Catalan数啊？求解答！</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-34199">
<article class="comment" id="comment-34199">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">didiaozuoren</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34199" rel="nofollow"><time datetime="2015-06-03T06:30:59+00:00" pubdate="">2015年6月3日 at 上午6:30</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>和编译器有关吧，我用的g++正常。头文件可能还需要一个&lt;string.h&gt;</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-34202">
<article class="comment" id="comment-34202">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">mr_zhang2011</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34202" rel="nofollow"><time datetime="2015-05-30T00:05:04+00:00" pubdate="">2015年5月30日 at 上午12:05</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>很不错！</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-34200">
<article class="comment" id="comment-34200">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">pascal</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34200" rel="nofollow"><time datetime="2015-05-28T21:10:57+00:00" pubdate="">2015年5月28日 at 下午9:10</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>思考人生吗</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-34198">
<article class="comment" id="comment-34198">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">yipwinghong</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34198" rel="nofollow"><time datetime="2015-05-20T14:21:40+00:00" pubdate="">2015年5月20日 at 下午2:21</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这个应该是比较简单的解法了，如果有更好的办法可以告诉我</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-59706">
<article class="comment" id="comment-59706">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">HenrryCheng</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-59706" rel="nofollow"><time datetime="2015-05-05T13:53:31+00:00" pubdate="">2015年5月5日 at 下午1:53</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>很好的思路，可以借鉴</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-34201">
<article class="comment" id="comment-34201">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">raymanshf</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-34201" rel="nofollow"><time datetime="2015-04-28T09:17:54+00:00" pubdate="">2015年4月28日 at 上午9:17</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这个还不错</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-51318">
<article class="comment" id="comment-51318">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">dream</a></span> on <a href="http://www.acmerblog.com/hdu-3842-machine-works-6844.html#comment-51318" rel="nofollow"><time datetime="2015-04-23T06:49:25+00:00" pubdate="">2015年4月23日 at 上午6:49</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>正解，我的方法占用的内存更多些</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>