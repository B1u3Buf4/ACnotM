<div class="c-top2" id="post-55">
<div class="datetime">2014<br/>04-09</div>
<div class="tit"><h1 class="entry-title">HDU 3499-Flight-动态规划-[解题报告]HOJ</h1>
<div class="entry-meta iititle2">
<span class="i2"><a href="http://www.acmerblog.com/author/spiderman" rel="author" title="由蜘蛛侠发布">蜘蛛侠</a></span><span class="i1"><a href="http://www.acmerblog.com/category/problemset/hdu" rel="category tag" title="查看HDU-杭电中的全部文章">HDU-杭电</a>, <a href="http://www.acmerblog.com/category/graph/shortest-path" rel="category tag" title="查看最短路径中的全部文章">最短路径</a>, <a href="http://www.acmerblog.com/category/dp2/line-dp" rel="category tag" title="查看线性DP中的全部文章">线性DP</a></span><span class="i4">围观208次</span><span class="i3"><a class="ds-thread-count" data-thread-key="5699" href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comments" title="《HDU 3499-Flight-动态规划-[解题报告]HOJ》上的评论">15 条评论</a></span>
</div>
</div>
<div class="cls"></div>
</div><div class="entry-content">
<div>
<h1 class="mytitle mybigtile">Flight</h1>
</div>
<div>
<p class="mytitle"> 问题描述 :</p>
</div>
<div class="mypanel">
Recently, Shua Shua had a big quarrel with his GF. He is so upset that he decides to take a trip to some other city to avoid meeting her. He will travel only by air and he can go to any city if there exists a flight and it can help him reduce the total cost to the destination. There’s a problem here: Shua Shua has a special credit card which can reduce half the price of a ticket ( i.e. 100 becomes 50, 99 becomes 49. The original and reduced price are both integers. ). But he can only use it once. He has no idea which flight he should choose to use the card to make the total cost least. Can you help him? </div>
<div>
<p class="mytitle"> 输入:</p>
</div>
<div class="mypanel">
There are no more than 10 test cases. Subsequent test cases are separated by a blank line. <br/>The first line of each test case contains two integers N and M ( 2 &lt;= N &lt;= 100,000 
<p>0 &lt;= M &lt;= 500,000 ), representing the number of cities and flights. Each of the following M lines contains "X Y D" representing a flight from city X to city Y with ticket price D ( 1 &lt;= D &lt;= 100,000 ). Notice that not all of the cities will appear in the list! The last line contains "S E" representing the start and end city. X, Y, S, E are all strings consisting of at most 10 alphanumeric characters.  </p></div>
<div>
<p class="mytitle"> 输出:</p>
</div>
<div class="mypanel">
There are no more than 10 test cases. Subsequent test cases are separated by a blank line. <br/>The first line of each test case contains two integers N and M ( 2 &lt;= N &lt;= 100,000 
<p>0 &lt;= M &lt;= 500,000 ), representing the number of cities and flights. Each of the following M lines contains "X Y D" representing a flight from city X to city Y with ticket price D ( 1 &lt;= D &lt;= 100,000 ). Notice that not all of the cities will appear in the list! The last line contains "S E" representing the start and end city. X, Y, S, E are all strings consisting of at most 10 alphanumeric characters. </p></div>
<div>
<p class="mytitle"> 样例输入:</p>
</div>
<pre class="mypanel iopanel">
4 4
Harbin Beijing 500
Harbin Shanghai 1000
Beijing Chengdu 600
Shanghai Chengdu 400
Harbin Chengdu

4 0
Harbin Chengdu</pre>
<div>
<p class="mytitle"> 样例输出:</p>
</div>
<pre class="mypanel iopanel">
800
-1


<div style="font-family:Times New Roman;font-size:14px;background-color:F4FBFF;border:#B7CBFF 1px dashed;padding:6px"><div style="font-family:Arial;font-weight:bold;color:#7CA9ED;border-bottom:#B7CBFF 1px dashed"><i>Hint</i></div>In the first sample, Shua Shua should use the card on the flight from
 Beijing to Chengdu, making the route Harbin-&gt;Beijing-&gt;Chengdu have the
 least total cost 800. In the second sample, there's no way for him to get to 
Chengdu from Harbin, so -1 is needed. </div><i style="font-size:1px"> </i></pre>
<p> <!-- problem end --></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong>自认为相当正确的代码，交上去TLE了。以为是自己的方法错了，从昨晚开始想，到底错哪了？昨晚上看到了熟人的代码，依然大牛。网上的解法大多是正反向最短路+枚举折半边。这样得出。但是我的代码是：用dist[x][0]记录到x点使用折半票的花费，dist[x][1]记录到x点全票的花费。这样dp方程就很容易出来了… 自己想吧。</strong></span></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong>今天下午改了改，发现这题光读入数据就要3600ms++,最终发现是我的spfa速度慢了。再继续追下去，发现是我的spfa用的数据结构不对，我用的栈，人家ac的用的队列。我的发现总结一下吧：</strong></span></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong>1.spfa用队列比用栈快，特别是在边很多的情况。</strong></span></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong>2.用STL的队列和栈的速度比自己实现的栈速度快。</strong></span></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong>3.dist[10000][2]&gt;dist1[10000]+dist2[10000]&gt;dist[2][10000],读取速度依次减少。</strong></span></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong>终于还是让哥给切掉了！ 哇卡卡卡！</strong></span></p>
<p><span style="font-family:'Microsoft YaHei'; font-size:18px"><strong></strong></span></p>
<pre class="brush:cpp" name="code">#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;string&gt;
#include&lt;queue&gt;
#include&lt;map&gt;
#define MAXN 111111
#define MAXM 555555
const __int64 INF=(_I64_MAX)&gt;&gt;1;
//const __int64 INF=4611686018427387903;
using namespace std;

struct node
{
 	   int v;
	   __int64 price;
 	   node* next;
}Edge[MAXM],*ptr[MAXN];

int EdgeNum;
int N,M;//N node,M edge
 	
void addEdge( int u,int v,__int64 price )
{
 	 node *p=&amp;Edge[EdgeNum++];
 	 p-&gt;price=price;
 	 p-&gt;v=v;
 	 p-&gt;next=ptr[u];
 	 ptr[u]=p;
}

__int64 dist[2][MAXN];
bool inS[MAXN];

__int64 spfa( int src,int dst )
{
 	 for( int i=0;i&lt;=N;i++ )
 	 {
 	 	  dist[1][i]=dist[0][i]=INF;
 	 	  inS[i]=false;
	 }
 	 queue&lt;int&gt;myQ;
 	 dist[1][src]=dist[0][src]=0;
 	 
	 int top=0;
	 myQ.push(src);
 	 inS[src]=true;
 	 
 	 while( !myQ.empty() )
 	 {
	  		int cur=myQ.front();
	  		myQ.pop();
	  		node *p=ptr[cur];
	  		while( p )
	  		{
			 	   bool flag=false;
			 	   if( dist[1][p-&gt;v]&gt;dist[1][cur]+p-&gt;price )
			 	   	   dist[1][p-&gt;v]=dist[1][cur]+p-&gt;price,flag=true;
			 	   	   
			 	   if( dist[0][p-&gt;v]&gt;dist[0][cur]+p-&gt;price ||  dist[0][p-&gt;v]&gt;dist[1][cur]+p-&gt;price/2 )
					   dist[0][p-&gt;v]=min( dist[0][cur]+p-&gt;price,dist[1][cur]+p-&gt;price/2 ),flag=true;
				   
				   if( flag &amp;&amp; inS[p-&gt;v]==false )
	   	   		   {
	   	   		   	   myQ.push(p-&gt;v);
		   	   	   	   inS[p-&gt;v]=true;
  	   			   }
			 	   p=p-&gt;next;
 	   		}
	  		inS[cur]=false;
	 }
	 return dist[0][dst];
}

string str1,str2;

int main()
{
 	while( scanf( "%d %d",&amp;N,&amp;M )!=EOF )
 	{
	 	   memset( ptr,0,sizeof(ptr) );
	 	   EdgeNum=0;
		   map&lt;string,int&gt;map;
 	 	   int citynum=1;
		   __int64 price;
		   //cout&lt;&lt;INF&lt;&lt;endl;
   	   	   map.clear();
   	   	   
		   for( int i=1;i&lt;=M;i++ )
		   {
		   		cin&gt;&gt;str1&gt;&gt;str2&gt;&gt;price;
		   		if( map.find(str1)==map.end() )
		   			map[str1]=citynum++;
		   		if( map.find(str2)==map.end() )
		   			map[str2]=citynum++;
		   		addEdge( map[str1],map[str2],price );
   		   }
	 	   cin&gt;&gt;str1&gt;&gt;str2;
	 	   //若SE城市中没有可去的边 
	 	   if( map.find(str1)==map.end() || map.find(str2)==map.end() )
	 	   {
	 	   	   printf("-1\n"); continue;
		   }
		   //S==E
		   else if( str1==str2 )
		   {
	 	   	    printf("0\n"); continue;
   		   }
   		   
	 	   __int64 ans=spfa( map[str1],map[str2] );
	 	   
		   if( ans==INF )
           	   printf("-1\n");
		   else
           	   printf("%I64d\n",ans);
  	}
  	return 0;
}
</pre>
<p>参考：<a href="#respond">http://blog.csdn.net/bysen32/article/details/7345252</a></p>
<div>
</script>
<!-- acm-hf-01 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-9460629317209118" data-ad-slot="5011774182" style="display:inline-block;width:728px;height:90px"></ins>

(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<div class="bdsharebuttonbox"><a class="bds_more" data-cmd="more" href="#"></a><a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间"></a><a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a><a class="bds_tqq" data-cmd="tqq" href="#" title="分享到腾讯微博"></a><a class="bds_renren" data-cmd="renren" href="#" title="分享到人人网"></a><a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信"></a></div>

</div><ol id="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-75986">
<article class="comment" id="comment-75986">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://www.renren.com/profile.do?id=919518765" rel="external nofollow">新用户900953</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-75986" rel="nofollow"><time datetime="2017-04-12T05:46:05+00:00" pubdate="">2017年4月12日 at 上午5:46</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>不错，支持了。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-30163">
<article class="comment" id="comment-30163">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">AE</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30163" rel="nofollow"><time datetime="2015-05-21T00:16:12+00:00" pubdate="">2015年5月21日 at 上午12:16</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>多谢指出，已改正</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-49251">
<article class="comment" id="comment-49251">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">dream</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-49251" rel="nofollow"><time datetime="2015-05-14T05:23:29+00:00" pubdate="">2015年5月14日 at 上午5:23</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>3，求得所有的为的总和sum—-&gt;所有数的总和<br/>
printf( "Not Possible" );—-&gt;printf("impossible");<br/>
对吗？</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-49253">
<article class="comment" id="comment-49253">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">raymanshf</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-49253" rel="nofollow"><time datetime="2015-03-09T13:42:55+00:00" pubdate="">2015年3月9日 at 下午1:42</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>很赞的解答</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-49250">
<article class="comment" id="comment-49250">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">spiderMan</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-49250" rel="nofollow"><time datetime="2015-02-19T16:25:28+00:00" pubdate="">2015年2月19日 at 下午4:25</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>这道题目的核心一句话是：取还是不取。<br/>
如果当前取，则index+1作为参数。如果当前不取，则任用index作为参数。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-30158">
<article class="comment" id="comment-30158">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">la0bei</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30158" rel="nofollow"><time datetime="2015-02-05T03:09:23+00:00" pubdate="">2015年2月5日 at 上午3:09</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>很好的思路，可以借鉴</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-30161">
<article class="comment" id="comment-30161">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">zclzcllove</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30161" rel="nofollow"><time datetime="2014-11-28T16:54:46+00:00" pubdate="">2014年11月28日 at 下午4:54</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>学习了</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-30160">
<article class="comment" id="comment-30160">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">tzf88888888</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30160" rel="nofollow"><time datetime="2014-11-21T03:16:26+00:00" pubdate="">2014年11月21日 at 上午3:16</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>给力的文章，例子也非常好</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-49252">
<article class="comment" id="comment-49252">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">ForgetVay</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-49252" rel="nofollow"><time datetime="2014-10-18T04:43:16+00:00" pubdate="">2014年10月18日 at 上午4:43</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>不错</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-30155">
<article class="comment" id="comment-30155">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">xin</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30155" rel="nofollow"><time datetime="2014-10-14T23:31:07+00:00" pubdate="">2014年10月14日 at 下午11:31</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>/*<br/>
 * =====================================================================================<br/>
 *<br/>
 *       Filename:  1366.cc<br/>
 *<br/>
 *    Description:<br/>
 *<br/>
 *        Version:  1.0<br/>
 *        Created:  2014年01月06日 14时52分14秒<br/>
 *       Revision:  none<br/>
 *       Compiler:  gcc<br/>
 *<br/>
 *         Author:  Wenxian Ni (Hello World~), <a href="mailto:niwenxianq@qq.com">niwenxianq@qq.com</a><br/>
 *   Organization:  AMS/ICT<br/>
 *<br/>
 * =====================================================================================<br/>
 */</p>
<p>#include<br/>
#include </p>
<p>using namespace std;</p>
<p>int main()<br/>
{<br/>
    stack st;<br/>
    int n,i,j;<br/>
    int test;<br/>
    int a[100001];<br/>
    int b[100001];<br/>
    while(cin&gt;&gt;n)<br/>
    {<br/>
       for(i=1;i&gt;a[i];<br/>
       for(i=1;i&gt;b[i];<br/>
        //st.clear();<br/>
        while(!st.empty())<br/>
            st.pop();<br/>
        i = 1;<br/>
        j = 1;</p>
<p>        while(in)<br/>
                break;<br/>
            }<br/>
            while(!st.empty()&amp;&amp;st.top()==b[j])<br/>
            {<br/>
                st.pop();<br/>
                j++;<br/>
            }<br/>
        }<br/>
        if(st.empty())<br/>
            cout&lt;&lt;"YES"&lt;&lt;endl;<br/>
        else<br/>
            cout&lt;&lt;"NO"&lt;&lt;endl;<br/>
    }<br/>
    return 0;<br/>
}</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-30157">
<article class="comment" id="comment-30157">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">super157</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30157" rel="nofollow"><time datetime="2014-10-06T20:44:16+00:00" pubdate="">2014年10月6日 at 下午8:44</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>失误失误，转载错了。已经改正，抱歉。</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-30159">
<article class="comment" id="comment-30159">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">liuk</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30159" rel="nofollow"><time datetime="2014-09-22T15:43:08+00:00" pubdate="">2014年9月22日 at 下午3:43</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>对，这里说的最长回文子序列，非子串</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-30156">
<article class="comment" id="comment-30156">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">leowww</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30156" rel="nofollow"><time datetime="2014-09-09T05:06:01+00:00" pubdate="">2014年9月9日 at 上午5:06</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>可以参考算法导论中的时间戳。就是结束访问时间，最后结束的顶点肯定是入度为0的顶点，因为DFS要回溯</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-30162">
<article class="comment" id="comment-30162">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">howhaw</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-30162" rel="nofollow"><time datetime="2014-06-10T19:34:34+00:00" pubdate="">2014年6月10日 at 下午7:34</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>哎，path[0]应该是从零开始吧，为什么是赋值1呢？</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-63554">
<article class="comment" id="comment-63554">
<footer class="comment-meta">
<cite class="comment-author vcard">
<span class="fn"><a class="url" href="http://fdsf" rel="external nofollow">AcmDream</a></span> on <a href="http://www.acmerblog.com/hdu-3499-flight-5699.html#comment-63554" rel="nofollow"><time datetime="2014-06-04T02:54:10+00:00" pubdate="">2014年6月4日 at 上午2:54</time></a> <span class="says">said:</span> </cite><!-- .comment-author .vcard -->
</footer>
<div class="comment-content"><p>88行是多余的，可以删除</p>
</div>
</article><!-- #comment-## -->
</li><!-- #comment-## -->
</ol>